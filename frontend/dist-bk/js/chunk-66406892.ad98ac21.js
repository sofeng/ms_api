(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66406892"],{"0ccc":function(e,t,s){"use strict";s("63dc")},"10d0":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],attrs:{title:e.title,visible:e.dialogVisible,width:e.width?e.width:"75%","close-on-click-modal":!1,top:"50px","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close},scopedSlots:e._u([{key:"footer",fn:function(){return[e._t("footer")]},proxy:!0}],null,!0)},[s("el-container",{staticClass:"main-content"},[s("el-aside",{staticClass:"tree-aside",attrs:{width:"250px"}},[e._t("aside")],2),s("el-container",[s("el-main",{staticClass:"case-content"},[e._t("default")],2)],1)],1)],1)},i=[],n=s("15bc"),r=s("f968"),o={name:"RelevanceDialog",components:{SelectMenu:r["a"],MsDialogFooter:n["a"]},data:function(){return{result:{},dialogVisible:!1}},props:["title","width"],methods:{open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1}}},l=o,c=(s("588a"),s("cba8")),d=Object(c["a"])(l,a,i,!1,null,"9045e872",null);t["a"]=d.exports},"149b":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ms-table-column",{attrs:{label:e.$t("test_track.issue.description"),prop:"description",field:e.field,"fields-width":e.fieldsWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-popover",{attrs:{placement:"right",width:"500",trigger:"hover","popper-class":"issues-popover"}},[s("mavon-editor",{ref:"md",staticClass:"mavon-editor",attrs:{editable:!1,"default-open":"preview",subfield:!1,toolbarsFlag:!1},model:{value:t.row.description,callback:function(s){e.$set(t.row,"description",s)},expression:"scope.row.description"}}),s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v(e._s(e.$t("test_track.issue.preview")))])],1)]}}])})},i=[],n=s("625a"),r={name:"IssueDescriptionTableItem",components:{MsTableColumn:n["a"]},data:function(){return{readConfig:{toolbar:[]}}},props:{field:Object,fieldsWidth:Object}},o=r,l=s("cba8"),c=Object(l["a"])(o,a,i,!1,null,"28c903d6",null);t["a"]=c.exports},"1e6b":function(e,t,s){"use strict";s("2c1c")},"27b6":function(e,t,s){"use strict";s("7e53")},"2c1c":function(e,t,s){},3105:function(e,t,s){},"4a4b":function(e,t,s){"use strict";s("dd789")},5060:function(e,t,s){"use strict";s("8864")},"588a":function(e,t,s){"use strict";s("3105")},"63dc":function(e,t,s){},"641e":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e._t("header",(function(){return[s("el-input",{attrs:{placeholder:e.$t("test_track.module.search"),size:"small",clearable:!0},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})]})),s("el-tree",{ref:"tree",staticClass:"filter-tree node-tree",attrs:{data:e.extendTreeNodes,"default-expanded-keys":e.expandedNode,"node-key":"id","filter-node-method":e.filterNode,"expand-on-click-node":!1,"highlight-current":"",draggable:!e.disabled},on:{"node-drag-end":e.handleDragEnd,"node-expand":e.nodeExpand,"node-collapse":e.nodeCollapse},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,i=t.data;return[s("span",{staticClass:"custom-tree-node father",on:{click:function(t){return e.handleNodeSelect(a)}}},[i.isEdit?s("span",{on:{click:function(e){e.stopPropagation()}}},[s("el-input",{ref:"nameInput",staticClass:"name-input",attrs:{size:"mini"},on:{blur:function(t){return t.stopPropagation(),e.save(a,i)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.stopPropagation(),t.target.blur())}},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"data.name"}})],1):e._e(),i.isEdit?e._e():s("span",{staticClass:"node-icon"},[s("i",{staticClass:"el-icon-folder"})]),i.isEdit?e._e():s("span",{staticClass:"node-title",domProps:{textContent:e._s(i.name)}}),"relevance"!==e.isDisplay?s("span",{staticClass:"count-title"},[s("span",{staticStyle:{color:"#6C317C"}},[e._v(e._s(i.caseNum))])]):e._e(),e.disabled?e._e():s("span",{staticClass:"node-operate child"},["root"!==i.id&&"默认模块"!==i.name?s("el-tooltip",{directives:[{name:"permission",rawName:"v-permission",value:e.updatePermission,expression:"updatePermission"}],staticClass:"item",attrs:{effect:"dark","open-delay":200,content:e.$t("test_track.module.rename"),placement:"top"}},[s("i",{staticClass:"el-icon-edit",on:{click:function(t){return t.stopPropagation(),e.edit(a,i)}}})]):e._e(),"默认模块"===i.name&&1!==i.level?s("el-tooltip",{directives:[{name:"permission",rawName:"v-permission",value:e.updatePermission,expression:"updatePermission"}],staticClass:"item",attrs:{effect:"dark","open-delay":200,content:e.$t("test_track.module.rename"),placement:"top"}},[s("i",{staticClass:"el-icon-edit",on:{click:function(t){return t.stopPropagation(),e.edit(a,i)}}})]):e._e(),s("el-tooltip",{directives:[{name:"permission",rawName:"v-permission",value:e.addPermission,expression:"addPermission"}],staticClass:"item",attrs:{effect:"dark","open-delay":200,content:e.$t("test_track.module.add_submodule"),placement:"top"}},[s("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return t.stopPropagation(),e.append(a,i)}}})]),"默认模块"===i.name&&1!==i.level?s("el-tooltip",{directives:[{name:"permission",rawName:"v-permission",value:e.deletePermission,expression:"deletePermission"}],staticClass:"item",attrs:{effect:"dark","open-delay":200,content:e.$t("commons.delete"),placement:"top"}},[s("i",{staticClass:"el-icon-delete",on:{click:function(t){return t.stopPropagation(),e.remove(a,i)}}})]):e._e(),"root"!==i.id&&"默认模块"!==i.name?s("el-tooltip",{directives:[{name:"permission",rawName:"v-permission",value:e.deletePermission,expression:"deletePermission"}],staticClass:"item",attrs:{effect:"dark","open-delay":200,content:e.$t("commons.delete"),placement:"top"}},[s("i",{staticClass:"el-icon-delete",on:{click:function(t){return t.stopPropagation(),e.remove(a,i)}}})]):e._e()],1)])]}}])})],2)},i=[],n=(s("51b3"),s("5a05"),s("89a8"),s("1a91"),s("993f"),s("cfe5"),s("10dd"),{name:"MsNodeTree",components:{},data:function(){return{result:{},filterText:"",expandedNode:[],defaultProps:{children:"children",label:"label"},extendTreeNodes:[]}},props:{isDisplay:{type:String},type:{type:String,default:"view"},treeNodes:{type:Array},allLabel:{type:String,default:function(){return this.$t("commons.all_label.case")}},nameLimit:{type:Number,default:function(){return 50}},updatePermission:Array,addPermission:Array,deletePermission:Array},watch:{treeNodes:function(){this.init()},filterText:function(e){this.filter(e)}},computed:{disabled:function(){return"edit"!==this.type}},methods:{init:function(){var e=0;this.treeNodes.forEach((function(t){e+=t.caseNum})),this.extendTreeNodes=[],this.extendTreeNodes.unshift({id:"root",name:this.allLabel,level:0,children:this.treeNodes,caseNum:e>0?e:""}),0===this.expandedNode.length&&this.expandedNode.push("root")},handleNodeSelect:function(e){var t=[],s=[];this.getChildNodeId(e.data,t),this.getParentNodes(e,s),this.$emit("nodeSelectEvent",e,t,s)},filterNode:function(e,t){return!e||!!t.label&&-1!==t.label.indexOf(e.toLowerCase())},filter:function(e){var t=this;this.$nextTick((function(){t.$refs.tree.filter(e)}))},nodeExpand:function(e){e.id&&this.expandedNode.push(e.id)},nodeCollapse:function(e){e.id&&this.expandedNode.splice(this.expandedNode.indexOf(e.id),1)},edit:function(e,t,s){var a=this;this.$set(t,"isEdit",!0),this.$nextTick((function(){a.$refs.nameInput.focus(),s||a.$nextTick((function(){a.filter(a.filterText)}))}))},increase:function(e){this.traverse(e,(function(e){e.caseNum&&e.caseNum++}),!0),"root"===this.extendTreeNodes[0].id&&this.extendTreeNodes[0].caseNum++},decrease:function(e){this.traverse(e,(function(e){e.caseNum&&e.caseNum--}),!0),"root"===this.extendTreeNodes[0].id&&this.extendTreeNodes[0].caseNum--},traverse:function(e,t,s){for(var a=0;a<this.treeNodes.length;a++){var i=this.treeNodes[a];this._traverse(i,e,t,s)}},_traverse:function(e,t,s,a){if(e.id===t)return s&&s(e),!0;if(!e.children)return!1;for(var i=0;i<e.children.length;i++){var n=e.children[i],r=this._traverse(n,t,s,a);if(!0===r)return a&&s(e),r}},append:function(e,t){var s=this,a={id:void 0,isEdit:!1,name:"",children:[]};t.children||this.$set(t,"children",[]),t.children.push(a),this.edit(e,a,!0),e.expanded=!0,this.$nextTick((function(){s.$refs.nameInput.focus()}))},save:function(e,t){if(""!==t.name.trim())if(t.name.trim().length>this.nameLimit)this.$warning(this.$t("test_track.length_less_than")+this.nameLimit);else if(t.name.indexOf("\\")>-1)this.$warning(this.$t("commons.node_name_tip"));else{var s={};this.buildSaveParam(s,e.parent.data,t),"edit"===s.type?this.$emit("edit",s):this.$emit("add",s),this.$set(t,"isEdit",!1)}else this.$warning(this.$t("test_track.case.input_name"))},remove:function(e,t){var s=this;if(void 0!==t.label){var a="确定删除节点 "+t.label+" 及其子节点下所有资源？";this.$alert(a,"",{confirmButtonText:this.$t("commons.confirm"),callback:function(t){if("confirm"===t){var a=[];s.getChildNodeId(e.data,a),s.$emit("remove",a)}}})}else this.$refs.tree.remove(e)},handleDragEnd:function(e,t,s,a){if("none"!==s&&void 0!==s){if("root"===t.data.id&&"before"===s||"默认模块"===e.data.name)return this.$emit("refresh"),!1;var i=this.buildParam(e,t,s),n=[];this.getNodeTree(this.treeNodes,e.data.id,n),"root"===i.parentId&&(i.parentId=void 0),this.$emit("drag",i,n)}},buildSaveParam:function(e,t,s){s.id?(e.nodeIds=[],e.type="edit",e.id=s.id,e.level=s.level,this.getChildNodeId(s,e.nodeIds)):(e.level=1,e.type="add","root"!=t.id&&(e.parentId=t.id,e.level=t.level+1)),e.name=s.name.trim(),e.label=s.name},buildParam:function(e,t,s){var a={};a.id=e.data.id,a.name=e.data.name,a.projectId=e.data.projectId,"inner"===s?(a.parentId=t.data.id,a.level=t.data.level+1):t.parent.id&&0!==t.parent.id?(a.parentId=t.parent.data.id,a.level=t.parent.data.level+1):(a.parentId=0,a.level=1);var i=[];if(this.getChildNodeId(e.data,i),1==t.data.level&&"inner"!=s)a.nodeTree=e.data;else for(var n=0;n<this.treeNodes.length;n++)if(a.nodeTree=this.findTreeByNodeId(this.treeNodes[n],t.data.id),a.nodeTree)break;return a.nodeIds=i,a},getNodeTree:function(e,t,s){if(e)for(var a=0;a<e.length;a++){if(e[a].id===t)return s[0]=a-1>=0?e[a-1].id:"",s[1]=e[a].id,void(a+1<e.length?s[2]=e[a+1].id:s[2]="");e[a].children&&this.getNodeTree(e[a].children,t,s)}},findTreeByNodeId:function(e,t){if(e.id==t)return e;if(e.children)for(var s=0;s<e.children.length;s++)if(this.findTreeByNodeId(e.children[s],t))return e},getChildNodeId:function(e,t){if(t.push(e.id),e.children)for(var s=0;s<e.children.length;s++)this.getChildNodeId(e.children[s],t)},getParentNodes:function(e,t){e.parent&&0!=e.parent.id&&this.getParentNodes(e.parent,t),e.data.name&&""!=e.data.name&&t.push(e.data)}}}),r=n,o=(s("4a4b"),s("cba8")),l=Object(o["a"])(r,a,i,!1,null,"7be2c578",null);t["a"]=l.exports},"656f":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-main",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],staticClass:"container",style:e.isPlan?"":"height: calc(100vh - 62px)"},[s("el-scrollbar",[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"right","label-width":"80px"}},[s("el-form-item",{attrs:{label:e.$t("commons.title"),prop:"title"}},[s("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),e.isFormAlive?s("el-form",{ref:"customFieldForm",staticClass:"case-form",attrs:{model:e.customFieldForm,rules:e.customFieldRules}},[s("el-row",{staticClass:"custom-field-row"},e._l(e.issueTemplate.customFields,(function(t,a){return s("el-col",{key:a,attrs:{span:8}},[s("el-form-item",{attrs:{label:t.system?e.$t(e.systemNameMap[t.name]):t.name,prop:t.name,"label-width":e.formLabelWidth}},[s("custom-filed-component",{attrs:{data:t,form:e.customFieldForm,prop:"defaultValue"},on:{reload:e.reloadForm}})],1)],1)})),1)],1):e._e(),s("form-rich-text-item",{attrs:{title:e.$t("custom_field.issue_content"),data:e.form,prop:"description"}}),s("el-row",{staticClass:"custom-field-row"},[e.hasTapdId?s("el-col",{attrs:{span:8}},[s("el-form-item",{attrs:{"label-width":e.formLabelWidth,label:e.$t("test_track.issue.tapd_current_owner"),prop:"tapdUsers"}},[s("el-select",{attrs:{multiple:"",filterable:"",placeholder:e.$t("test_track.issue.please_choose_current_owner")},model:{value:e.form.tapdUsers,callback:function(t){e.$set(e.form,"tapdUsers",t)},expression:"form.tapdUsers"}},e._l(e.tapdUsers,(function(e,t){return s("el-option",{key:t,attrs:{label:e.user,value:e.user}})})),1)],1)],1):e._e(),e.hasZentaoId?s("el-col",{attrs:{span:8}},[s("el-form-item",{attrs:{"label-width":e.formLabelWidth,label:e.$t("test_track.issue.zentao_bug_build"),prop:"zentaoBuilds"}},[s("el-select",{attrs:{multiple:"",filterable:"",placeholder:e.$t("test_track.issue.zentao_bug_build")},model:{value:e.form.zentaoBuilds,callback:function(t){e.$set(e.form,"zentaoBuilds",t)},expression:"form.zentaoBuilds"}},e._l(e.Builds,(function(e,t){return s("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1)],1):e._e(),e.hasZentaoId?s("el-col",{attrs:{span:8}},[s("el-form-item",{attrs:{"label-width":e.formLabelWidth,label:e.$t("test_track.issue.zentao_bug_assigned"),prop:"zentaoAssigned"}},[s("el-select",{attrs:{filterable:"",placeholder:e.$t("test_track.issue.please_choose_current_owner")},model:{value:e.form.zentaoAssigned,callback:function(t){e.$set(e.form,"zentaoAssigned",t)},expression:"form.zentaoAssigned"}},e._l(e.zentaoUsers,(function(e,t){return s("el-option",{key:t,attrs:{label:e.name,value:e.user}})})),1)],1)],1):e._e()],1),e.isPlan?e._e():s("el-form-item",[s("test-case-issue-list",{ref:"testCaseIssueList",attrs:{"test-case-contain-ids":e.testCaseContainIds,"issues-id":e.form.id}})],1)],1)],1)],1)},i=[],n=(s("89a8"),s("d25d"),s("b110"),s("fe35"),s("e766"),s("1a91"),s("10dd"),s("9722")),r=s("0b84"),o=s("d4ca"),l=s("ca90"),c=s("9345"),d=s("e5a9"),u=s("cdbb"),p=s("438e"),f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-button",{attrs:{type:"primary"},on:{click:e.relateTestCase}},[e._v(e._s(e.$t("test_track.review_view.relevance_case")))]),s("ms-table",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],ref:"table",attrs:{"enable-selection":!1,operators:e.operators,data:e.tableData,"screen-height":null},on:{refresh:e.initTableData}},[s("ms-table-column",{attrs:{label:e.$t("commons.id"),prop:"num"}}),s("ms-table-column",{attrs:{label:e.$t("commons.name"),prop:"name"}}),s("ms-table-column",{attrs:{label:e.$t("test_track.case.priority"),prop:"name"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("priority-table-item",{ref:"priority",attrs:{value:e.row.priority}})]}}])}),s("ms-table-column",{attrs:{label:e.$t("test_track.case.type"),prop:"type"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("type-table-item",{attrs:{value:e.row.type}})]}}])}),s("ms-table-column",{attrs:{label:e.$t("test_track.case.module"),prop:"nodePath"}}),s("ms-table-column",{attrs:{label:e.$t("test_track.plan.plan_project"),prop:"projectName"}})],1),s("test-case-relate-list",{ref:"testCaseRelevance",attrs:{"test-case-contain-ids":e.testCaseContainIds},on:{refresh:e.initTableData,save:e.handleRelate}})],1)},m=[],h=s("045d"),b=(s("993f"),s("0ac8")),v=s("625a"),g=s("0f4e"),_=s("e23e"),y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("test-case-relevance-base",{ref:"baseRelevance",on:{setProject:e.setProject,save:e.save},scopedSlots:e._u([{key:"aside",fn:function(){return[s("ms-node-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],ref:"nodeTree",staticClass:"node-tree",attrs:{"tree-nodes":e.treeNodes},on:{nodeSelectEvent:e.nodeChange}})]},proxy:!0}])},[s("el-card",[s("ms-table-header",{attrs:{condition:e.condition,title:"","show-create":!1},on:{search:e.initTableData}}),s("ms-table",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],ref:"table",attrs:{data:e.tableData,condition:e.condition,total:e.total,"page-size":e.pageSize,"show-select-all":!1},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},handlePageChange:e.initTableData,refresh:e.initTableData}},[s("ms-table-column",{attrs:{label:e.$t("commons.id"),prop:"num"}}),s("ms-table-column",{attrs:{label:e.$t("commons.name"),prop:"name"}}),s("ms-table-column",{attrs:{label:e.$t("test_track.case.priority"),prop:"name"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("priority-table-item",{ref:"priority",attrs:{value:e.row.priority}})]}}])}),s("ms-table-column",{attrs:{label:e.$t("test_track.case.type"),prop:"type"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("type-table-item",{attrs:{value:e.row.type}})]}}])}),s("ms-table-column",{attrs:{label:e.$t("test_track.case.module"),prop:"nodePath"}}),s("ms-table-column",{attrs:{label:e.$t("test_track.plan.plan_project"),prop:"projectName"}})],1),s("ms-table-pagination",{attrs:{change:e.initTableData,"current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t}}})],1)],1)},$=[],I=s("cf5a"),C=s("ae75"),k=s("59d9"),T=s("10b9"),j=s("9b10"),w=s("7da5"),N=s("641e"),S={name:"TestCaseRelateList",components:{TypeTableItem:_["a"],PriorityTableItem:g["a"],MsNodeTree:N["a"],TestCaseRelevanceBase:w["a"],MsEditDialog:j["a"],MsTableHeader:T["a"],MsTablePagination:k["a"],MsTableButton:C["a"],MsTableColumn:v["a"],MsTable:b["a"]},data:function(){return{tableData:[],condition:{},visible:!1,total:0,pageSize:10,currentPage:1,projectId:"",result:{},treeNodes:[],projects:[],selectNodeIds:[]}},props:["testCaseContainIds"],watch:{selectNodeIds:function(){this.initTableData()},projectId:function(){this.getProjectNode(),this.initTableData()}},computed:{fields:function(){return I["a"]}},methods:{initTableData:function(){var e=this;this.condition.projectId=this.projectId,this.selectNodeIds&&this.selectNodeIds.length>0?this.condition.nodeIds=this.selectNodeIds:this.condition.nodeIds=[],this.projectId&&(this.condition.projectId=this.projectId,this.condition.testCaseContainIds=Array.from(this.testCaseContainIds),this.result=this.$post("/test/case/relate/issue/"+ +this.currentPage+"/"+this.pageSize,this.condition,(function(t){var s=t.data;e.total=s.itemCount,e.tableData=s.listObject})))},nodeChange:function(e,t,s){this.selectNodeIds=t,this.selectNodeNames=s},getProjectNode:function(e){var t=this;e&&(this.projectId=e),this.$refs.nodeTree.result=this.$post("/case/node/list/project",{projectId:this.projectId},(function(e){t.treeNodes=e.data})),this.selectNodeIds=[]},open:function(){this.$refs.baseRelevance.open(),this.initTableData()},save:function(){this.$emit("save",this.$refs.table.selectRows),this.$refs.table.clear(),this.$refs.baseRelevance.close()},setProject:function(e){this.projectId=e}}},x=S,P=s("cba8"),O=Object(P["a"])(x,y,$,!1,null,"036aedfe",null),F=O.exports,E={name:"TestCaseIssueList",components:{TestCaseRelateList:F,TypeTableItem:_["a"],PriorityTableItem:g["a"],MsTableColumn:v["a"],MsTable:b["a"]},data:function(){return{result:{},tableData:[],operators:[{tip:this.$t("commons.delete"),icon:"el-icon-delete",type:"danger",exec:this.handleDelete}]}},props:{issuesId:String,testCaseContainIds:Set},methods:{handleDelete:function(e,t){this.testCaseContainIds.delete(e.id),this.tableData.splice(t,1)},initTableData:function(){var e=this;this.tableData=[];var t={issuesId:this.issuesId};this.issuesId&&(this.result=this.$post("test/case/issues/list",t,(function(t){e.tableData=t.data,e.tableData.forEach((function(t){e.testCaseContainIds.add(t.id)})),e.$refs.table.reloadTable()})))},relateTestCase:function(){this.$refs.testCaseRelevance.open()},handleRelate:function(e){var t,s=this,a=Array.from(e);a.forEach((function(e){e.id&&s.testCaseContainIds.add(e.id)})),(t=this.tableData).push.apply(t,Object(h["a"])(a))}}},D=E,z=Object(P["a"])(D,f,m,!1,null,"51c6f15d",null),M=z.exports,R=s("495f"),A=s("5c7a"),L={name:"IssueEditDetail",components:{IssueEditDetail:U,TestCaseIssueList:M,CustomFiledComponent:p["a"],FormRichTextItem:c["a"],CustomFieldRelateList:l["a"],CustomFieldFormList:o["a"],MsFormDivider:r["a"],TemplateComponentEditHeader:n["a"]},data:function(){return{result:{},relateFields:[],isFormAlive:!0,formLabelWidth:"150px",issueTemplate:{},customFieldForm:{},customFieldRules:{},rules:{title:[{required:!0,message:this.$t("commons.please_fill_content"),trigger:"blur"},{max:64,message:this.$t("test_track.length_less_than")+"64",trigger:"blur"}],description:[{required:!0,message:this.$t("commons.please_fill_content"),trigger:"blur"}]},testCaseContainIds:new Set,url:"",form:{title:"",description:"",creator:null},tapdUsers:[],zentaoUsers:[],Builds:[],hasTapdId:!1,hasZentaoId:!1}},props:{isPlan:{type:Boolean,default:function(){return!1}},caseId:String,planId:String},computed:{isSystem:function(){return this.form.system},systemNameMap:function(){return d["j"]},projectId:function(){return Object(R["g"])()}},methods:{open:function(e){var t=this,s=this.initEdit;Object(A["a"])().then((function(a){t.issueTemplate=a,t.getThirdPartyInfo(),s(e)}))},getThirdPartyInfo:function(){var e=this,t=this.issueTemplate.platform;"Zentao"===t&&(this.hasZentaoId=!0,this.result=this.$post("/issues/zentao/builds",{projectId:this.projectId,organizationId:Object(R["f"])()},(function(t){t.data&&(e.Builds=t.data),e.result=e.$post("/issues/zentao/user",{projectId:e.projectId,organizationId:Object(R["f"])()},(function(t){e.zentaoUsers=t.data}))}))),"Tapd"===t&&(this.hasTapdId=!0,this.result=this.$post("/issues/tapd/user",{projectId:this.projectId,organizationId:Object(R["f"])()},(function(t){e.tapdUsers=t.data})))},initEdit:function(e){var t=this;this.testCaseContainIds=new Set,e?(Object.assign(this.form,e),e.options instanceof Array||(this.form.options=e.options?JSON.parse(e.options):[]),e.id?this.url="issues/update":(this.url="issues/add",this.form.creator||(this.form.creator=Object(R["i"])()),this.form.title=e.title+"_copy")):(this.form={title:this.issueTemplate.title,description:this.issueTemplate.content},this.url="issues/add",this.form.creator||(this.form.creator=Object(R["i"])())),Object(u["d"])(this.form,this.issueTemplate,this.customFieldForm,this.customFieldRules,null),this.$nextTick((function(){t.$refs.testCaseIssueList&&t.$refs.testCaseIssueList.initTableData()}))},reloadForm:function(){var e=this;this.isFormAlive=!1,this.$nextTick((function(){return e.isFormAlive=!0}))},save:function(){var e=!0;this.$refs["form"].validate((function(t){if(!t)return e=!1,!1})),this.$refs["customFieldForm"].validate((function(t){if(!t)return e=!1,!1})),e&&this._save()},buildPram:function(){var e={};return Object.assign(e,this.form),e.projectId=this.projectId,e.organizationId=Object(R["f"])(),Object(u["a"])(this.form,e,this.issueTemplate),this.isPlan?e.testCaseIds=[this.caseId]:e.testCaseIds=Array.from(this.testCaseContainIds),this.planId&&(e.resourceId=this.planId),e},_save:function(){var e=this,t=this.buildPram();this.parseOldFields(t),this.result=this.$post(this.url,t,(function(){e.$emit("close"),e.$success(e.$t("commons.save_success")),e.$emit("refresh")}))},parseOldFields:function(e){var t=e.customFields;if(t){var s=JSON.parse(t);s.forEach((function(t){"状态"===t.name&&(e.status=t.value)}))}}}},B=L,W=(s("5060"),Object(P["a"])(B,a,i,!1,null,"50a77f02",null)),U=t["a"]=W.exports},"6d8e":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ms-container",[s("ms-main-container",[s("el-card",{staticClass:"table-card",scopedSlots:e._u([{key:"header",fn:function(){return[s("ms-table-header",{attrs:{"create-permission":["PROJECT_TRACK_ISSUE:READ+CREATE"],condition:e.page.condition,"create-tip":e.$t("test_track.issue.create_issue"),tip:e.$t("commons.search_by_name_or_id")},on:{"update:condition":function(t){return e.$set(e.page,"condition",t)},search:e.getIssues,create:e.handleCreate},scopedSlots:e._u([{key:"button",fn:function(){return[e.isThirdPart?s("el-tooltip",{attrs:{content:e.$t("test_track.issue.update_third_party_bugs")}},[s("ms-table-button",{attrs:{icon:"el-icon-refresh",content:e.$t("test_track.issue.sync_bugs")},on:{click:e.syncIssues}})],1):e._e()]},proxy:!0}])})]},proxy:!0}])},[s("ms-table",{directives:[{name:"loading",rawName:"v-loading",value:e.page.result.loading,expression:"page.result.loading"}],ref:"table",attrs:{data:e.page.data,enableSelection:!1,condition:e.page.condition,total:e.page.total,"page-size":e.page.pageSize,operators:e.operators,"show-select-all":!1,"screen-height":e.screenHeight,fields:e.fields,"field-key":e.tableHeaderKey,"custom-fields":e.issueTemplate.customFields},on:{"update:pageSize":function(t){return e.$set(e.page,"pageSize",t)},"update:page-size":function(t){return e.$set(e.page,"pageSize",t)},handlePageChange:e.getIssues,"update:fields":function(t){e.fields=t},saveSortField:e.saveSortField,refresh:e.getIssues}},e._l(e.fields,(function(t){return s("span",{key:t.key},[s("ms-table-column",{attrs:{width:"1"}}),s("ms-table-column",{attrs:{label:e.$t("test_track.issue.id"),prop:"num",field:t,sortable:"","fields-width":e.fieldsWidth}}),s("ms-table-column",{attrs:{field:t,"fields-width":e.fieldsWidth,label:e.$t("test_track.issue.title"),sortable:"",prop:"title"}}),s("ms-table-column",{attrs:{field:t,"fields-width":e.fieldsWidth,filters:e.platformFilters,label:e.$t("test_track.issue.platform"),prop:"platform"}}),s("ms-table-column",{attrs:{field:t,"fields-width":e.fieldsWidth,sortable:"",label:e.$t("test_track.issue.platform_status"),prop:"platformStatus"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.platformStatus?t.row.platformStatus:"--")+" ")]}}],null,!0)}),s("ms-table-column",{attrs:{field:t,"fields-width":e.fieldsWidth,"column-key":"creator",sortable:"",label:e.$t("custom_field.issue_creator"),prop:"creatorName"}}),s("ms-table-column",{attrs:{field:t,"fields-width":e.fieldsWidth,label:e.$t("test_track.issue.issue_resource"),prop:"resourceName"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.resourceName?s("el-link",{on:{click:function(s){return e.$router.push("/track/plan/view/"+t.row.resourceId)}}},[e._v(" "+e._s(t.row.resourceName)+" ")]):s("span",[e._v(" -- ")])]}}],null,!0)}),s("ms-table-column",{attrs:{prop:"createTime",field:t,"fields-width":e.fieldsWidth,label:e.$t("commons.create_time"),sortable:"","min-width":"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e._f("timestampFormatDate")(t.row.createTime)))])]}}],null,!0)}),s("issue-description-table-item",{attrs:{"fields-width":e.fieldsWidth,field:t}}),s("ms-table-column",{attrs:{field:t,"fields-width":e.fieldsWidth,label:t.label,prop:"caseCount"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("router-link",{attrs:{to:t.row.caseCount>0?{name:"testCase",params:{projectId:"all",ids:t.row.caseIds}}:{}}},[e._v(" "+e._s(t.row.caseCount)+" ")])]}}],null,!0)}),e._l(e.issueTemplate.customFields,(function(a){return s("ms-table-column",{key:a.id,attrs:{field:t,"fields-width":e.fieldsWidth,label:a.name,prop:a.name},scopedSlots:e._u([{key:"default",fn:function(t){return["状态"===a.name?s("span",[e._v(" "+e._s(e.getCustomFieldValue(t.row,a)?e.getCustomFieldValue(t.row,a):e.issueStatusMap[t.row.status])+" ")]):s("span",[e._v(" "+e._s(e.getCustomFieldValue(t.row,a))+" ")])]}}],null,!0)})}))],2)})),0),s("ms-table-pagination",{attrs:{change:e.getIssues,"current-page":e.page.currentPage,"page-size":e.page.pageSize,total:e.page.total},on:{"update:currentPage":function(t){return e.$set(e.page,"currentPage",t)},"update:current-page":function(t){return e.$set(e.page,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.page,"pageSize",t)},"update:page-size":function(t){return e.$set(e.page,"pageSize",t)}}}),s("issue-edit",{ref:"issueEdit",on:{refresh:e.getIssues}})],1)],1)],1)},i=[],n=(s("993f"),s("10dd"),s("87d5"),s("0ac8")),r=s("625a"),o=s("1763"),l=s("ae75"),c=s("59d9"),d=s("e5a9"),u=s("10b9"),p=s("149b"),f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-drawer",{ref:"drawer",staticClass:"field-template-edit",attrs:{"before-close":e.handleClose,visible:e.visible,"with-header":!1,size:"100%","modal-append-to-body":!1},on:{"update:visible":function(t){e.visible=t}},scopedSlots:e._u([{key:"default",fn:function(t){return[s("template-component-edit-header",{attrs:{"show-edit":!1,template:{},prop:"title"},on:{cancel:e.handleClose,save:e.save}}),s("issue-edit-detail",{ref:"issueEditDetail",on:{refresh:function(t){return e.$emit("refresh")},close:e.handleClose}})]}}])})},m=[],h=s("9722"),b=s("656f"),v={name:"IssueEdit",components:{IssueEditDetail:b["a"],TemplateComponentEditHeader:h["a"]},data:function(){return{visible:!1}},methods:{open:function(e){var t=this;this.visible=!0,this.$nextTick((function(){t.$refs.issueEditDetail.open(e)}))},handleClose:function(){this.visible=!1},save:function(){this.$refs.issueEditDetail.save()}}},g=v,_=s("cba8"),y=Object(_["a"])(g,f,m,!1,null,"c79c89ce",null),$=y.exports,I=s("7542"),C=s("e077"),k=s("1b11"),T=s("489a"),j=s("495f"),w=s("5c7a"),N=s("8d85"),S={name:"IssueList",components:{MsMainContainer:T["a"],MsContainer:k["a"],IssueEdit:$,IssueDescriptionTableItem:p["a"],MsTableHeader:u["a"],MsTablePagination:c["a"],MsTableButton:l["a"],MsTableOperators:o["a"],MsTableColumn:r["a"],MsTable:n["a"]},data:function(){return{page:Object(C["t"])(),fields:[],tableHeaderKey:"ISSUE_LIST",fieldsWidth:Object(C["p"])("ISSUE_LIST"),screenHeight:"calc(100vh - 200px)",operators:[{tip:this.$t("commons.edit"),icon:"el-icon-edit",exec:this.handleEdit,isDisable:this.btnDisable,permissions:["PROJECT_TRACK_ISSUE:READ+EDIT"]},{tip:this.$t("commons.copy"),icon:"el-icon-copy-document",type:"success",exec:this.handleCopy,isDisable:this.btnDisable},{tip:this.$t("commons.delete"),icon:"el-icon-delete",type:"danger",exec:this.handleDelete,isDisable:this.btnDisable,permissions:["PROJECT_TRACK_ISSUE:READ+DELETE"]}],issueTemplate:{},members:[],isThirdPart:!1}},activated:function(){var e=this;Object(N["a"])((function(t){e.members=t})),Object(w["a"])().then((function(t){if(e.issueTemplate=t,"metersphere"===e.issueTemplate.platform?e.isThirdPart=!1:e.isThirdPart=!0,e.fields=Object(C["v"])("ISSUE_LIST",e.issueTemplate.customFields),!e.isThirdPart)for(var s=0;s<e.fields.length;s++)if("platformStatus"===e.fields[s].id){e.fields.splice(s,1);break}e.$refs.table.reloadTable()})),this.getIssues()},computed:{fieldFilters:function(){return d["d"]},platformFilters:function(){return d["f"]},sceneFilters:function(){return d["c"]},fieldTypeMap:function(){return d["e"]},issueStatusMap:function(){return d["g"]},systemNameMap:function(){return d["j"]},projectId:function(){return Object(j["g"])()}},methods:{getCustomFieldValue:function(e,t){return Object(C["m"])(e,t,this.members)},getIssues:function(){this.page.condition.projectId=this.projectId;var e=this.getSortField();e&&(this.page.condition.orders=e),this.page.result=Object(I["a"])(this.page)},handleEdit:function(e){this.$refs.issueEdit.open(e)},handleCreate:function(){this.$refs.issueEdit.open()},handleCopy:function(e){var t={};Object.assign(t,e),t.id=null,t.name=e.name+"_copy",this.$refs.issueEdit.open(t)},handleDelete:function(e){var t=this;this.page.result=this.$get("issues/delete/"+e.id,(function(){t.$success(t.$t("commons.delete_success")),t.getIssues()}))},btnDisable:function(e){return"Local"!==e.platform},saveSortField:function(e,t){Object(C["z"])(e,JSON.stringify(t))},syncIssues:function(){var e=this;this.page.result=Object(I["d"])((function(){e.getIssues()}))},getSortField:function(){var e=Object(C["r"])(this.tableHeaderKey),t=null;if(e)try{t=JSON.parse(e)}catch(s){return null}return t}}},x=S,P=(s("27b6"),Object(_["a"])(x,a,i,!1,null,"56390f9c",null));t["default"]=P.exports},7542:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return l})),s.d(t,"e",(function(){return c})),s.d(t,"c",(function(){return d})),s.d(t,"d",(function(){return u}));s("87d5"),s("304d"),s("f257");var a=s("422a"),i=s("e077"),n=s("495f");function r(e){for(var t=e.data,s=0;s<t.length;s++)t[s]&&t[s].customFields&&(t[s].customFields=JSON.parse(t[s].customFields))}function o(e){return Object(a["post"])("issues/list/"+e.currentPage+"/"+e.pageSize,e.condition,(function(t){Object(i["s"])(t,e),r(e)}))}function l(e,t){if(e)return Object(a["get"])("issues/get/"+e,(function(e){t.data=e.data,r(t)}))}function c(e,t){return Object(a["post"])("test/case/issues/relate",e,(function(e){t&&t(e)}))}function d(e){return Object(a["post"])("issues/list/relate/"+e.currentPage+"/"+e.pageSize,e.condition,(function(t){Object(i["s"])(t,e),r(e)}))}function u(e){return Object(a["get"])("issues/sync/"+Object(n["g"])(),(function(t){e&&e(t)}))}},"7da5":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("relevance-dialog",{ref:"relevanceDialog",attrs:{width:e.width,title:e.dialogTitle},scopedSlots:e._u([{key:"aside",fn:function(){return[s("select-menu",{attrs:{data:e.projects,width:"160px","current-data":e.currentProject,title:e.$t("test_track.switch_project")},on:{dataChange:e.changeProject}}),e._t("aside")]},proxy:!0},{key:"footer",fn:function(){return[e.$slots.footer?s("div",[e._t("footer")],2):s("div",[e.flag?s("div",{staticStyle:{"margin-bottom":"15px"}},[s("el-checkbox",{model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v(e._s(e.$t("test_track.sync_add_api_load")))])],1):e._e(),s("ms-dialog-footer",{on:{cancel:e.close,confirm:e.save}})],1)]},proxy:!0}],null,!0)},[e._t("default")],2)},i=[],n=(s("3ef3"),s("10dd"),s("15bc")),r=s("f968"),o=s("10d0"),l=s("495f"),c={name:"TestCaseRelevanceBase",components:{RelevanceDialog:o["a"],SelectMenu:r["a"],MsDialogFooter:n["a"]},data:function(){return{checked:!0,result:{},currentProject:{},projectId:"",projectName:"",projects:[]}},props:{planId:{type:String},dialogTitle:{type:String,default:function(){return this.$t("test_track.plan_view.relevance_test_case")}},flag:{type:Boolean},width:String},watch:{},methods:{refreshNode:function(){this.$emit("refresh")},save:function(){this.$emit("save",this.checked)},close:function(){this.$refs.relevanceDialog.close()},open:function(){this.getProject(),this.$refs.relevanceDialog.open()},getProject:function(){var e=this;this.result=this.$post("/project/list/related",{userId:Object(l["i"])(),workspaceId:Object(l["j"])()},(function(t){var s=t.data;if(s){var a=s.findIndex((function(e){return e.id===Object(l["g"])()}));e.projects=s,-1!==a?(e.projectId=s[a].id,e.projectName=s[a].name,e.changeProject(s[a])):(e.projectId=s[0].id,e.projectName=s[0].name,e.changeProject(s[0]))}}))},changeProject:function(e){this.currentProject=e,this.$emit("setProject",e.id),this.$emit("refreshNode")}}},d=c,u=s("cba8"),p=Object(u["a"])(d,a,i,!1,null,"72d9ae5d",null);t["a"]=p.exports},"7e53":function(e,t,s){},8864:function(e,t,s){},"8d85":function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));s("89a8");var a=s("495f"),i=s("422a");function n(e){return new Promise((function(t){Object(i["post"])("/user/project/member/tester/list",{projectId:Object(a["g"])()},(function(s){e&&e(s.data),t(s.data)}))}))}},9722:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-row",{staticClass:"head-bar",attrs:{type:"flex"}},[s("el-col",{attrs:{span:12}},[e.showEdit?s("div",{staticClass:"name-edit"},[s("el-input",{attrs:{placeholder:e.$t("test_track.plan_view.input_template_name")},model:{value:e.template[e.prop],callback:function(t){e.$set(e.template,e.prop,t)},expression:"template[prop]"}}),e.template[e.prop]?s("span",{staticClass:"title"},[e._v(e._s(e.template[e.prop]))]):s("span",{staticClass:"name-tip"},[e._v(e._s(e.$t("test_track.plan_view.input_template_name")))])],1):e._e()]),s("el-col",{staticClass:"head-right",attrs:{span:12}},[s("el-button",{attrs:{plain:"",size:"mini"},on:{click:e.handleCancel}},[e._v(e._s(e.$t("test_track.return")))]),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleSave}},[e._v(e._s(e.$t("test_track.save")))])],1)],1)},i=[],n={name:"TemplateComponentEditHeader",data:function(){return{}},props:{template:{type:Object,default:function(){return{}}},prop:{type:String,default:function(){return"name"}},showEdit:{type:Boolean,default:function(){return!0}}},methods:{handleCancel:function(){this.$emit("cancel")},handleSave:function(){this.$emit("save")}}},r=n,o=(s("1e6b"),s("cba8")),l=Object(o["a"])(r,a,i,!1,null,"91dbcada",null);t["a"]=l.exports},cdbb:function(e,t,s){"use strict";s.d(t,"d",(function(){return o})),s.d(t,"a",(function(){return l})),s.d(t,"c",(function(){return c})),s.d(t,"b",(function(){return d}));var a=s("ebb4"),i=(s("89a8"),s("1a91"),s("10dd"),s("fe35"),s("d25d"),s("b110"),s("993f"),s("87d5"),s("bb13"),s("0692")),n=s("e5a9");function r(e,t){e.defaultValue=t,e.hasParse=!0}function o(e,t,s,o,l){var c=!1;e.customFields||(c=!0,e.customFields={}),e.customFields instanceof Object||e.customFields instanceof Array||(e.customFields=JSON.parse(e.customFields)),t.customFields.forEach((function(t){if(t.defaultValue&&!t.hasParse&&r(t,JSON.parse(t.defaultValue)),t.required){var d=(t.system?i["default"].t(n["j"][t.name]):t.name)+i["default"].t("commons.cannot_be_null");o&&(o[t.name]=[{required:!0,message:d,trigger:"blur"}])}if(c&&l){var u,p=Object(a["a"])(l.keys());try{for(p.s();!(u=p.n()).done;){var f=u.value;t.name===f&&l.get(f)&&r(t,l.get(f))}}catch(v){p.e(v)}finally{p.f()}}if(e.customFields instanceof Array)for(var m=0;m<e.customFields.length;m++){var h=e.customFields[m];if(h.name===t.name){r(t,h.value);break}}else if(e.customFields instanceof Object)for(var b in e.customFields)t.name===b&&e.customFields[b]&&r(t,JSON.parse(e.customFields[b]));s&&(s[t.name]=t.defaultValue)}))}function l(e,t,s){if(s.customFields){e.customFields instanceof Array||(e.customFields=[]);var a=e.customFields;if(a)for(var i=new Set,n=a.length-1;n>=0;n--){var r=a[n].name;i.has(r)&&a.splice(n,1),i.add(r)}s.customFields.forEach((function(e){var t=!1;for(var s in a)if(a[s].name===e.name){t=!0,a[s].name=e.name,a[s].value=e.defaultValue;break}if(!t){var i={id:e.id,name:e.name,value:e.defaultValue,type:e.type,customData:e.customData};a.push(i)}})),t.customFields=JSON.stringify(a)}}function c(e,t){return new Promise((function(s){var a={};t.$get(e+t.projectId,(function(e){a=e.data,a.customFields&&a.customFields.forEach((function(e){e.options&&(e.options=JSON.parse(e.options))})),s(a)}))}))}function d(e){var t=new Map;return t.set("用例状态",e.status),t.set("责任人",e.maintainer),t.set("用例等级",e.priority),t}},dd789:function(e,t,s){},f968:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"select-menu"},[s("span",{staticClass:"menu-title"},[e._v(e._s("["+e.title+"]"))]),s("el-select",{style:{width:e.width},attrs:{slot:"prepend",filterable:"",size:"small"},on:{change:e.changeData},slot:"prepend",model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.data,(function(e,t){return s("el-option",{key:t,attrs:{label:e.name,value:t}})})),1)],1)},i=[],n=(s("10dd"),{name:"SelectMenu",props:{data:{type:Array},currentData:{type:Object},title:{type:String},width:{type:String,default:function(){return"214px"}}},data:function(){return{value:""}},watch:{currentData:function(e){void 0!=e&&null!=e&&(this.value=e.name)}},methods:{changeData:function(e){this.$emit("dataChange",this.data[e])}}}),r=n,o=(s("0ccc"),s("cba8")),l=Object(o["a"])(r,a,i,!1,null,"3a00cab0",null);t["a"]=l.exports}}]);