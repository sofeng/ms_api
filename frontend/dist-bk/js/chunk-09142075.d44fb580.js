(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09142075"],{"0b72":function(t,e,n){},"1e6b":function(t,e,n){"use strict";n("2c1c")},"2c1c":function(t,e,n){},"5e312":function(t,e,n){"use strict";n("0b72")},6602:function(t,e,n){"use strict";n("ac4b")},"6cd07":function(t,e,n){"use strict";n("ce14")},8501:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-drawer",{directives:[{name:"loading",rawName:"v-loading",value:t.result.loading,expression:"result.loading"}],ref:"drawer",attrs:{"before-close":t.handleClose,visible:t.showDialog,"with-header":!1,size:"100%","modal-append-to-body":!1},on:{"update:visible":function(e){t.showDialog=e}},scopedSlots:t._u([{key:"default",fn:function(e){return[n("template-component-edit-header",{attrs:{template:t.template},on:{cancel:t.handleClose,save:t.handleSave}}),n("div",{staticClass:"container"},[n("el-aside",[n("div",{staticClass:"description"},[n("span",{staticClass:"title"},[t._v(t._s(t.$t("test_track.plan_view.component_library")))]),n("span",[t._v(t._s(t.$t("test_track.plan_view.component_library_tip")))])]),n("draggable",{staticClass:"dragArea list-group",attrs:{list:t.components,group:{name:"component",pull:"clone",put:!1},clone:t.clonePreview}},[n("transition-group",t._l(t.components,(function(e){return n("template-component-bar",{key:e,attrs:{component:t.componentMap.get(e)}})})),1)],1)],1),n("el-main",[n("draggable",{staticClass:"dragArea list-group",attrs:{list:t.previews,group:"component"},on:{change:t.change}},[n("transition-group",t._l(t.previews,(function(e){return n("div",{key:e.id,staticClass:"preview"},[n("template-component",{attrs:{"is-report-view":!1,"is-report":t.isReport,metric:t.metric,preview:e}}),n("i",{staticClass:"el-icon-error",on:{click:function(n){return t.handleDelete(e)}}})],1)})),0)],1)],1)],1)]}}])})},a=[],i=(n("bb13"),n("89a8"),n("b110"),n("fe35"),n("1a91"),n("d5ee"),n("10dd"),n("993f"),n("87bf"),n("cea3"),n("4c1e"),n("6370"),n("bbe2"),n("87d5"),n("3335")),o=n.n(i),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-button",{staticClass:"template-component"},[n("i",{staticClass:"el-icon-s-unfold"}),n("span",[t._v(t._s(t.component.name))]),"system"==t.component.type?n("el-tag",{attrs:{size:"mini",type:"success"}},[t._v(t._s(t.$t("commons.system")))]):t._e(),"custom"==t.component.type?n("el-tag",{attrs:{size:"mini"}},[t._v(t._s(t.$t("commons.custom")))]):t._e()],1)},p=[],l={name:"TemplateComponentBar",props:{component:{type:Object,default:function(){return{}}}}},r=l,m=(n("6cd07"),n("cba8")),u=Object(m["a"])(r,c,p,!1,null,"c97ad796",null),d=u.exports,h=n("9722"),f=(n("4abd"),n("495f")),_=n("0565"),v={name:"TestCaseReportTemplateEdit",components:{TemplateComponent:_["a"],TemplateComponentEditHeader:h["a"],TemplateComponentBar:d,draggable:o.a},data:function(){return{showDialog:!1,result:{},name:"",type:"edit",componentMap:new Map([[1,{name:this.$t("test_track.plan_view.base_info"),id:1,type:"system"}],[2,{name:this.$t("test_track.plan_view.test_result"),id:2,type:"system"}],[3,{name:this.$t("test_track.plan_view.result_distribution"),id:3,type:"system"}],[4,{name:this.$t("test_track.plan_view.failure_case"),id:4,type:"system"}],[5,{name:this.$t("test_track.plan_view.defect_list"),id:5,type:"system"}],[6,{name:this.$t("test_track.plan_view.custom_component"),id:6,type:"custom"}]]),components:[6],previews:[],template:{},isReport:!1}},props:{metric:{type:Object}},methods:{listenGoBack:function(){window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.goBack,!1))},goBack:function(){this.handleClose()},open:function(t,e){e&&(this.isReport=e),this.template={name:"",content:{components:[1,2,3,4,5,6],customComponent:new Map}},this.previews=[],this.components=[6],t?(this.type="edit",this.getTemplateById(t)):(this.type="add",this.initComponents()),this.showDialog=!0,this.listenGoBack()},initComponents:function(){var t=this;this.componentMap.forEach((function(e,n){t.template.content.components.indexOf(n)<0&&t.components.indexOf(n)<0&&t.components.push(n)})),this.template.content.components.forEach((function(e){var n=t.componentMap.get(e);if(n&&"custom"!=n.type)t.previews.push(n);else if(t.template.content.customComponent){var s=t.template.content.customComponent.get(e.toString());s&&t.previews.push({id:e,title:s.title,content:s.content})}}))},handleClose:function(){window.removeEventListener("popstate",this.goBack,!1),this.showDialog=!1},change:function(t){if(t.added){var e=t.added.element;if("system"==e.type)for(var n=0;n<this.components.length;n++)this.deleteComponentById(e.id)}},clonePreview:function(t){var e=this.componentMap.get(t),n=t;return"system"!=e.type&&(n=this.generateComponentId()),{id:n,name:e.name,type:e.type}},handleDelete:function(t){if(1!=this.previews.length){for(var e=0;e<this.previews.length;e++)if(this.previews[e].id==t.id){this.previews.splice(e,1),"system"==t.type&&this.components.push(t.id);break}}else this.$warning(this.$t("test_track.plan_view.delete_component_tip"))},generateComponentId:function(){return Date.parse(new Date)+Math.ceil(1e5*Math.random())},deleteComponentById:function(t){for(var e=0;e<this.components.length;e++)if(this.components[e]==t){this.components.splice(e,1);break}},getTemplateById:function(t){var e=this,n="/case/report/template/get/";this.isReport&&(n="/case/report/get/"),this.$get(n+t,(function(t){e.template=t.data,e.template.content=JSON.parse(t.data.content),e.template.content.customComponent&&(e.template.content.customComponent=Object(f["u"])(e.template.content.customComponent),e.template.startTime&&(e.metric.startTime=new Date(e.template.startTime)),e.template.endTime&&(e.metric.endTime=new Date(e.template.endTime))),e.initComponents()}))},handleSave:function(){var t=this,e=new RegExp("[`~!@#$^&*=|{}':;',<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]");if(null!=this.template.name&&""!=this.template.name)if(this.template.name.length>64)this.$warning(this.$t("commons.name")+this.$t("test_track.length_less_than")+"64");else if(e.test(this.template.name))this.$warning(this.$t("test_track.plan_view.template_special_characters"));else{var n={};this.buildParam(n);var s="/case/report/template/";this.isReport&&(s="/case/report/"),this.$post(s+this.type,n,(function(){t.$success(t.$t("commons.save_success")),t.handleClose(),t.$emit("refresh")}))}else this.$warning(this.$t("test_track.plan_view.input_template_name"))},buildParam:function(t){var e=this,n={components:[]};n.customComponent=new Map,this.previews.forEach((function(t){n.components.push(t.id),e.componentMap.get(t.id)||n.customComponent.set(t.id,{title:t.title,content:t.content})})),t.name=this.template.name,n.customComponent&&(n.customComponent=Object(f["w"])(n.customComponent)),t.content=JSON.stringify(n),"edit"==this.type?t.id=this.template.id:t.workspaceId=Object(f["j"])(),this.template.workspaceId&&(t.workspaceId=Object(f["j"])()),this.metric&&this.metric.startTime&&(t.startTime=this.metric.startTime.getTime()),this.metric&&this.metric.endTime&&(t.endTime=this.metric.endTime.getTime())}}},w=v,g=(n("6602"),Object(m["a"])(w,s,a,!1,null,"eeabc148",null));e["a"]=g.exports},9722:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-row",{staticClass:"head-bar",attrs:{type:"flex"}},[n("el-col",{attrs:{span:12}},[t.showEdit?n("div",{staticClass:"name-edit"},[n("el-input",{attrs:{placeholder:t.$t("test_track.plan_view.input_template_name")},model:{value:t.template[t.prop],callback:function(e){t.$set(t.template,t.prop,e)},expression:"template[prop]"}}),t.template[t.prop]?n("span",{staticClass:"title"},[t._v(t._s(t.template[t.prop]))]):n("span",{staticClass:"name-tip"},[t._v(t._s(t.$t("test_track.plan_view.input_template_name")))])],1):t._e()]),n("el-col",{staticClass:"head-right",attrs:{span:12}},[n("el-button",{attrs:{plain:"",size:"mini"},on:{click:t.handleCancel}},[t._v(t._s(t.$t("test_track.return")))]),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleSave}},[t._v(t._s(t.$t("test_track.save")))])],1)],1)},a=[],i={name:"TemplateComponentEditHeader",data:function(){return{}},props:{template:{type:Object,default:function(){return{}}},prop:{type:String,default:function(){return"name"}},showEdit:{type:Boolean,default:function(){return!0}}},methods:{handleCancel:function(){this.$emit("cancel")},handleSave:function(){this.$emit("save")}}},o=i,c=(n("1e6b"),n("cba8")),p=Object(c["a"])(o,s,a,!1,null,"91dbcada",null);e["a"]=p.exports},ac4b:function(t,e,n){},ce14:function(t,e,n){},cf83:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"testcase-template",on:{click:t.templateEdit}},[n("div",{staticClass:"template-img"},[n("i",{staticClass:"el-icon-error",on:{click:function(e){return e.stopPropagation(),t.templateDelete.apply(null,arguments)}}})]),n("span",{staticClass:"demonstration"},[t._v(t._s(t.template.name))])])},a=[],i=(n("10dd"),{name:"TestcaseTemplateItem",props:{template:{type:Object,default:function(){return{}}}},methods:{templateEdit:function(){this.$emit("templateEdit",this.template.id)},templateDelete:function(){var t=this;this.$alert(this.$t("load_test.delete_file_confirm")+this.template.name+"？","",{confirmButtonText:this.$t("commons.confirm"),callback:function(e){"confirm"===e&&t.handleDelete()}})},handleDelete:function(){var t=this;this.$post("/case/report/template/delete/"+this.template.id,{},(function(){t.$success(t.$t("commons.delete_success")),t.$emit("refresh")}))}}}),o=i,c=(n("5e312"),n("cba8")),p=Object(c["a"])(o,s,a,!1,null,"bbb1f886",null);e["a"]=p.exports}}]);