(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cb368246"],{"3f79":function(e,t,s){"use strict";s("d67b")},"4e30":function(e,t,s){},"551e":function(e,t,s){},"987a":function(e,t,s){},a66e:function(e,t,s){"use strict";s("987a")},b0d47:function(e,t,s){"use strict";s("4e30")},b79f:function(e,t,s){},d67b:function(e,t,s){},eda4:function(e,t,s){"use strict";s("551e")},f80e:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ms-container",[s("ms-main-container",[s("el-card",[s("el-container",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],staticClass:"test-container"},[s("el-header",[s("el-row",[s("el-input",{staticClass:"test-name",attrs:{disabled:e.isReadOnly,maxlength:"60",placeholder:e.$t("api_test.input_name"),"show-word-limit":""},model:{value:e.test.name,callback:function(t){e.$set(e.test,"name",t)},expression:"test.name"}},[s("template",{slot:"prepend"},[e._v("测试名称")])],2),s("el-tooltip",{attrs:{content:"Ctrl + S",placement:"top",enterable:!1}},[s("el-button",{attrs:{type:"primary",plain:"",disabled:e.isReadOnly},on:{click:e.saveTest}},[e._v(" "+e._s(e.$t("commons.save"))+" ")])],1),s("el-button",{attrs:{type:"primary",plain:"",disabled:e.isReadOnly},on:{click:e.saveRunTest}},[e._v(" "+e._s(e.$t("load_test.save_and_run"))+" ")]),s("el-button",{attrs:{disabled:e.isReadOnly,type:"warning",plain:""},on:{click:e.cancel}},[e._v(e._s(e.$t("commons.cancel"))+" ")]),s("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleCommand}},[s("el-button",{staticClass:"el-dropdown-link more",attrs:{icon:"el-icon-more",plain:""}}),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"report"}},[e._v(" "+e._s(e.$t("api_report.title"))+" ")]),s("el-dropdown-item",{attrs:{command:"jar",disabled:e.isReadOnly}},[e._v(" "+e._s(e.$t("api_test.jar_config.title"))+" ")]),s("el-dropdown-item",{attrs:{command:"performance",disabled:e.create||e.isReadOnly}},[e._v(" "+e._s(e.$t("api_test.create_performance_test"))+" ")]),s("el-dropdown-item",{attrs:{command:"export",disabled:e.isReadOnly||e.create}},[e._v(" "+e._s(e.$t("api_test.export_config"))+" ")]),s("el-dropdown-item",{attrs:{command:"import",disabled:e.isReadOnly}},[e._v(" "+e._s(e.$t("api_test.api_import.label"))+" ")])],1)],1),s("api-import",{ref:"apiImport"}),s("ms-api-report-dialog",{ref:"reportDialog",attrs:{"test-id":e.id}}),s("ms-schedule-config",{attrs:{schedule:e.test.schedule,"is-read-only":e.isReadOnly,save:e.saveCronExpression,"test-id":e.id,"check-open":e.checkScheduleEdit},on:{scheduleChange:e.saveSchedule}}),s("ms-jar-config",{ref:"jarConfig",attrs:{"is-read-only":e.isReadOnly}})],1)],1),s("ms-api-scenario-config",{ref:"config",attrs:{"debug-report-id":e.debugReportId,"is-read-only":e.isReadOnly,test:e.test,scenarios:e.test.scenarioDefinition,"project-id":e.test.projectId},on:{runDebug:e.runDebug}})],1)],1)],1)],1)},n=[],a=s("ebb4"),o=(s("4c1e"),s("bbe2"),s("89a8"),s("1a91"),s("fee8"),s("10dd"),s("8aff")),r=s("4dd5"),l=s("c7ab"),c=s("f58a"),d=s("495f"),u=s("fdd5"),p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],staticClass:"api-import",attrs:{"close-on-click-modal":!1,title:e.$t("api_test.api_import.title"),visible:e.visible},on:{"update:visible":function(t){e.visible=t},close:e.close}},[s("div",{staticClass:"header-bar"},[s("div",[e._v(e._s(e.$t("api_test.api_import.data_format")))]),s("el-radio-group",{model:{value:e.selectedPlatformValue,callback:function(t){e.selectedPlatformValue=t},expression:"selectedPlatformValue"}},e._l(e.platforms,(function(t,i){return s("el-radio",{key:i,attrs:{label:t.value}},[e._v(e._s(t.name))])})),1),s("div",{staticClass:"operate-button"},[s("el-button",{staticClass:"save-button",attrs:{type:"primary",plain:""},on:{click:e.save}},[e._v(" "+e._s(e.$t("commons.save"))+" ")]),s("el-button",{staticClass:"cancel-button",attrs:{type:"warning",plain:""},on:{click:function(t){e.visible=!1}}},[e._v(" "+e._s(e.$t("commons.cancel"))+" ")])],1)],1),s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],ref:"form",attrs:{model:e.formData,rules:e.rules,"label-width":"100px"}},[s("el-row",[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.$t("commons.name"),prop:"name"}},[s("el-input",{staticClass:"name-input",attrs:{size:"small",clearable:"","show-word-limit":""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),s("el-form-item",{attrs:{label:e.$t("commons.project"),prop:"projectId"}},[s("el-select",{staticClass:"project-select",attrs:{size:"small",clearable:""},model:{value:e.formData.projectId,callback:function(t){e.$set(e.formData,"projectId",t)},expression:"formData.projectId"}},e._l(e.projects,(function(e,t){return s("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),e.useEnvironment||"Swagger2"==e.selectedPlatformValue?s("el-form-item",{attrs:{label:e.$t("api_test.environment.environment_config"),prop:"environmentId"}},[e.showEnvironmentSelect?s("el-select",{staticClass:"environment-select",attrs:{size:"small",clearable:""},scopedSlots:e._u([{key:"empty",fn:function(){return[s("div",{staticClass:"empty-environment"},[s("el-button",{staticClass:"environment-button",attrs:{disabled:""==e.formData.projectId,size:"mini",type:"primary"},on:{click:e.openEnvironmentConfig}},[e._v(e._s(e.$t("api_test.environment.environment_config")))])],1)]},proxy:!0}],null,!1,4075774033),model:{value:e.formData.environmentId,callback:function(t){e.$set(e.formData,"environmentId",t)},expression:"formData.environmentId"}},[e._l(e.environments,(function(e,t){return s("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),s("el-button",{staticClass:"environment-button",attrs:{size:"mini",type:"primary"},on:{click:e.openEnvironmentConfig}},[e._v(e._s(e.$t("api_test.environment.environment_config")))])],2):e._e()],1):e._e(),"Swagger2"!=e.selectedPlatformValue?s("el-form-item",{attrs:{prop:"useEnvironment"}},[s("el-checkbox",{model:{value:e.useEnvironment,callback:function(t){e.useEnvironment=t},expression:"useEnvironment"}},[e._v(e._s(e.$t("api_test.environment.config_environment")))])],1):e._e(),"Swagger2"==e.selectedPlatformValue&&e.swaggerUrlEable?s("el-form-item",{attrs:{label:"Swagger URL",prop:"wgerUrl"}},[s("el-input",{attrs:{size:"small",clearable:"","show-word-limit":""},model:{value:e.formData.swaggerUrl,callback:function(t){e.$set(e.formData,"swaggerUrl",t)},expression:"formData.swaggerUrl"}})],1):e._e(),"Swagger2"==e.selectedPlatformValue?s("el-form-item",[s("el-switch",{attrs:{"active-text":e.$t("api_test.api_import.swagger_url_import")},model:{value:e.swaggerUrlEable,callback:function(t){e.swaggerUrlEable=t},expression:"swaggerUrlEable"}})],1):e._e()],1),"Swagger2"!=e.selectedPlatformValue||"Swagger2"==e.selectedPlatformValue&&!e.swaggerUrlEable?s("el-col",{attrs:{span:1}},[s("el-divider",{attrs:{direction:"vertical"}})],1):e._e(),"Swagger2"!=e.selectedPlatformValue||"Swagger2"==e.selectedPlatformValue&&!e.swaggerUrlEable?s("el-col",{attrs:{span:12}},[s("el-upload",{staticClass:"api-upload",attrs:{drag:"",action:"","http-request":e.upload,limit:1,beforeUpload:e.uploadValidate,"on-remove":e.handleRemove,"file-list":e.fileList,"on-exceed":e.handleExceed,multiple:""}},[s("i",{staticClass:"el-icon-upload"}),s("div",{staticClass:"el-upload__text",domProps:{innerHTML:e._s(e.$t("load_test.upload_tips"))}}),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.$t("api_test.api_import.file_size_limit")))])])],1):e._e()],1)],1),s("div",{staticClass:"format-tip"},[s("div",[s("span",[e._v(e._s(e.$t("api_test.api_import.tip"))+"："+e._s(e.selectedPlatform.tip))])]),s("div",[s("span",[e._v(e._s(e.$t("api_test.api_import.export_tip"))+"："+e._s(e.selectedPlatform.exportTip))])])]),s("api-environment-config",{ref:"environmentConfig",on:{close:e.getEnvironments}})],1)},m=[],f=(s("d25d"),s("b110"),s("fe35"),s("15bc")),h=s("c134"),v={name:"ApiImport",components:{ApiEnvironmentConfig:h["a"],MsDialogFooter:f["a"]},data:function(){return{visible:!1,swaggerUrlEable:!1,showEnvironmentSelect:!0,platforms:[{name:"Metersphere",value:"Metersphere",tip:this.$t("api_test.api_import.ms_tip"),exportTip:this.$t("api_test.api_import.ms_export_tip"),suffixes:new Set(["json"])},{name:"Postman",value:"Postman",tip:this.$t("api_test.api_import.postman_tip"),exportTip:this.$t("api_test.api_import.post_export_tip"),suffixes:new Set(["json"])},{name:"Swagger",value:"Swagger2",tip:this.$t("api_test.api_import.swagger_tip"),exportTip:this.$t("api_test.api_import.swagger_export_tip"),suffixes:new Set(["json"])}],selectedPlatform:{},selectedPlatformValue:"Metersphere",result:{},projects:[],environments:[],useEnvironment:!1,formData:{name:"",environmentId:"",projectId:"",file:void 0,swaggerUrl:""},rules:{name:[{required:!0,message:this.$t("commons.input_name"),trigger:"blur"},{max:60,message:this.$t("commons.input_limit",[1,60]),trigger:"blur"}],environmentId:[{required:!0,message:this.$t("api_test.environment.select_environment"),trigger:"blur"}],projectId:[{required:!0,message:this.$t("api_test.select_project"),trigger:"blur"}]},fileList:[]}},activated:function(){this.selectedPlatform=this.platforms[0],this.getProjects()},watch:{selectedPlatformValue:function(){for(var e in this.platforms)if(this.platforms[e].value===this.selectedPlatformValue){this.selectedPlatform=this.platforms[e];break}},"formData.projectId":function(){this.getEnvironments()}},methods:{open:function(){this.visible=!0,Object(d["v"])(this.close)},upload:function(e){this.formData.file=e.file},handleExceed:function(e,t){this.$warning(this.$t("test_track.case.import.upload_limit_count"))},handleRemove:function(e,t){this.formData.file=void 0},uploadValidate:function(e,t){var s=e.name.substring(e.name.lastIndexOf(".")+1);return this.selectedPlatform.suffixes.has(s)?!(e.size/1024/1024>20)||(this.$warning(this.$t("test_track.case.import.upload_limit_size")),!1):(this.$warning(this.$t("api_test.api_import.suffixFormatErr")),!1)},getEnvironments:function(){var e=this;this.formData.projectId?this.$get("/api/environment/list/"+this.formData.projectId,(function(t){e.environments=t.data;var s=!1;e.environments.forEach((function(t){t.id===e.formData.environmentId&&(s=!0)})),s||(e.formData.environmentId="")})):(this.environments=[],this.formData.environmentId="")},getProjects:function(){var e=this;this.result=this.$get("/project/listAll",(function(t){e.projects=t.data}))},openEnvironmentConfig:function(){this.formData.projectId?(this.showEnvironmentSelect=!1,this.$refs.environmentConfig.open(this.formData.projectId),this.showEnvironmentSelect=!0):this.$error(this.$t("api_test.select_project"))},save:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;var s={};Object.assign(s,e.formData),s.platform=e.selectedPlatformValue,s.useEnvironment=e.useEnvironment,"Swagger2"==e.selectedPlatformValue&&("Swagger2"!=e.selectedPlatformValue||e.swaggerUrlEable)||e.formData.file?(e.swaggerUrlEable||(s.swaggerUrl=void 0),e.result=e.$fileUpload("/api/import",s.file,null,s,(function(t){var s=t.data;e.$success(e.$t("test_track.case.import.success")),e.visible=!1,e.$router.push({path:"/api/test/edit",query:{id:s.id}})}))):e.$warning(e.$t("commons.please_upload"))}))},close:function(){this.formData={name:"",environmentId:"",projectId:"",file:void 0,swaggerUrl:""},this.fileList=[],Object(d["z"])(this.close),this.visible=!1}}},b=v,g=(s("b0d47"),s("cba8")),_=Object(g["a"])(b,p,m,!1,null,"97ce4ae4",null),w=_.exports,$=s("1b11"),y=s("489a"),k=s("1420"),x={name:"MsApiTestConfig",components:{MsJarConfig:k["a"],MsMainContainer:y["a"],MsContainer:$["a"],ApiImport:w,MsScheduleConfig:u["a"],MsApiReportDialog:c["a"],MsApiReportStatus:l["a"],MsApiScenarioConfig:o["a"]},props:["id"],data:function(){return{reportVisible:!1,create:!1,result:{},projects:[],change:!1,test:new r["F"],isReadOnly:!1,debugReportId:""}},watch:{$route:"init",test:{handler:function(){this.change=!0},deep:!0}},methods:{init:function(){this.isReadOnly=!1,this.id?(this.create=!1,this.getTest(this.id)):(this.create=!0,this.test=new r["F"],this.$refs.config&&this.$refs.config.reset()),this.test.projectId=Object(d["g"])()},updateReference:function(){var e=this,t=[];this.test.scenarioDefinition.forEach((function(e){e.isReference()&&t.push(e.id.split("#")[0])})),0!==t.length&&(this.result=this.$post("/api/list/ids",{ids:t},(function(t){var s={};t.data&&t.data.forEach((function(e){JSON.parse(e.scenarioDefinition).forEach((function(t){var i=e.id+"#"+t.id;s[i]=new r["B"](t),s[i].id=i}))}));var i=[];e.test.scenarioDefinition.forEach((function(e){if(e.isReference()){if(s[e.id]){var t=s[e.id];t.referenceEnable=e.referenceEnable,i.push(t)}}else i.push(e)})),e.test.scenarioDefinition=i})))},getTest:function(e){var t=this;this.result=this.$get("/api/get/"+e,(function(e){if(e.data){var s=e.data;t.test=new r["F"]({id:s.id,projectId:s.projectId,name:s.name,status:s.status,scenarioDefinition:JSON.parse(s.scenarioDefinition),schedule:s.schedule?s.schedule:{}}),t.updateReference(),t.$refs.config.reset()}}))},save:function(e){var t=this,s=this.test.isValid();if(s.isValid){this.change=!1;var i=this.getBodyUploadFiles(),n=this.create?"/api/create":"/api/update",a=this.test.toJMX(),o=new Blob([a.xml],{type:"application/octet-stream"}),r=new File([o],a.name);this.result=this.$fileUpload(n,r,i,this.test,(function(){e&&e(),t.create=!1,t.resetBodyFile()}))}else this.$warning(this.$t(s.info))},saveTest:function(){var e=this;this.save((function(){e.$success(e.$t("commons.save_success")),e.create&&e.$router.push({path:"/api/test/edit?id="+e.test.id})}))},runTest:function(){var e=this;this.result=this.$post("/api/run",{id:this.test.id,triggerMode:"MANUAL"},(function(t){e.$success(e.$t("api_test.running")),e.$router.push({path:"/api/report/view/"+t.data})}))},saveRunTest:function(){var e=this;this.change=!1,this.validateEnableTest()?this.save((function(){e.$success(e.$t("commons.save_success")),e.runTest()})):this.$warning(this.$t("api_test.enable_validate_tip"))},getBodyUploadFiles:function(){var e=this,t=[];return this.test.bodyUploadIds=[],this.test.scenarioDefinition.forEach((function(s){s.requests.forEach((function(s){s.body&&s.body.kvs.forEach((function(s){s.files&&s.files.forEach((function(s){if(s.file){var i=Object(d["m"])().substring(0,8);s.name=s.file.name,s.id=i,e.test.bodyUploadIds.push(i),t.push(s.file)}}))}))}))})),t},validateEnableTest:function(){var e,t=Object(a["a"])(this.test.scenarioDefinition);try{for(t.s();!(e=t.n()).done;){var s=e.value;if(s.enable){var i,n=Object(a["a"])(s.requests);try{for(n.s();!(i=n.n()).done;){var o=i.value;if(o.enable)return!0}}catch(r){n.e(r)}finally{n.f()}}}}catch(r){t.e(r)}finally{t.f()}return!1},resetBodyFile:function(){this.test.scenarioDefinition.forEach((function(e){e.requests.forEach((function(e){e.body&&e.body.kvs.forEach((function(e){e.files&&e.files.forEach((function(e){e.file&&(e.file=void 0)}))}))}))}))},cancel:function(){this.$router.push("/api/test/list/all")},handleCommand:function(e){switch(e){case"report":this.$refs.reportDialog.open();break;case"performance":this.$store.commit("setTest",{name:this.test.name,jmx:this.test.toJMX()}),this.$router.push({path:"/performance/test/create"});break;case"export":Object(d["b"])(this.test.name+".json",this.test.export());break;case"jar":this.$refs.jarConfig.open();break;case"import":this.$refs.apiImport.open();break}},saveCronExpression:function(e){this.test.schedule.enable=!0,this.test.schedule.value=e,this.saveSchedule()},saveSchedule:function(){var e=this;this.checkScheduleEdit();var t={};t=this.test.schedule,t.resourceId=this.test.id,t.projectId||(t.projectId=Object(d["g"])()),t.workspaceId||(t.workspaceId=Object(d["j"])());var s="/api/schedule/create";t.id&&(s="/api/schedule/update"),this.$post(s,t,(function(){e.$success(e.$t("commons.save_success")),e.getTest(e.test.id)}))},checkScheduleEdit:function(){return!this.create||(this.$message(this.$t("api_test.environment.please_save_test")),!1)},runDebug:function(e){var t=this;if(this.create)this.$warning(this.$t("api_test.environment.please_save_test"));else{var s="/api/run/debug",i=new r["F"];Object.assign(i,this.test);var n=this.getBodyUploadFiles();i.scenarioDefinition=[],i.scenarioDefinition.push(e);var a=i.isValid();if(a.isValid){var o=i.toJMX(),l=new Blob([o.xml],{type:"application/octet-stream"}),c=new File([l],o.name);this.$fileUpload(s,c,n,this.test,(function(e){t.debugReportId=e.data,t.resetBodyFile()}))}else this.$warning(this.$t(a.info))}},handleEvent:function(e){if(83===e.keyCode&&e.ctrlKey)return this.saveTest(),e.preventDefault(),e.returnValue=!1,!1}},created:function(){this.init(),document.addEventListener("keydown",this.handleEvent)},beforeDestroy:function(){document.removeEventListener("keydown",this.handleEvent)}},E=x,C=(s("a66e"),Object(g["a"])(E,i,n,!1,null,"f830a9a0",null));t["default"]=C.exports},fdd5:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"schedule-config"},[s("div",[s("span",{staticClass:"cron-ico",on:{click:e.scheduleEdit}},[s("i",{staticClass:"el-icon-date",attrs:{size:"small"}}),s("span",{staticClass:"character"},[e._v("SCHEDULER")])]),s("el-switch",{attrs:{disabled:!e.schedule.value||e.isReadOnly},on:{change:e.scheduleChange},model:{value:e.schedule.enable,callback:function(t){e.$set(e.schedule,"enable",t)},expression:"schedule.enable"}}),s("ms-schedule-edit",{ref:"scheduleEdit",attrs:{"is-read-only":e.isReadOnly,schedule:e.schedule,"test-id":e.testId,save:e.save,"custom-validate":e.customValidate}})],1),s("div",[s("span",[e._v(" "+e._s(e.$t("schedule.next_execution_time"))+"： "),e.schedule.enable?e._e():s("span",{class:{"disable-character":!e.schedule.enable}},[e._v(e._s(e.$t("schedule.not_set")))]),e.schedule.enable?s("crontab-result",{ref:"crontabResult",attrs:{"enable-simple-mode":!0,ex:e.schedule.value}}):e._e()],1)])])},n=[],a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"schedule-edit",attrs:{"close-on-click-modal":!1,width:"60%",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[[s("div",[s("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:e.$t("schedule.edit_timer_task"),name:"first"}},[s("el-form",{ref:"from",attrs:{model:e.form,rules:e.rules}},[s("el-form-item",{attrs:{prop:"cronValue"}},[s("el-input",{staticClass:"inp",attrs:{disabled:e.isReadOnly,placeholder:e.$t("schedule.please_input_cron_expression")},model:{value:e.form.cronValue,callback:function(t){e.$set(e.form,"cronValue",t)},expression:"form.cronValue"}}),s("el-button",{attrs:{disabled:e.isReadOnly,type:"primary"},on:{click:e.saveCron}},[e._v(e._s(e.$t("commons.save"))+" ")])],1),s("el-form-item",[s("el-link",{attrs:{disabled:e.isReadOnly,type:"primary"},on:{click:e.showCronDialog}},[e._v(" "+e._s(e.$t("schedule.generate_expression"))+" ")])],1),s("crontab-result",{ref:"crontabResult",attrs:{ex:e.form.cronValue}})],1),s("el-dialog",{attrs:{width:"60%",title:e.$t("schedule.generate_expression"),visible:e.showCron,modal:!1},on:{"update:visible":function(t){e.showCron=t}}},[s("crontab",{ref:"crontab",attrs:{expression:e.schedule.value},on:{hide:function(t){e.showCron=!1},fill:e.crontabFill}})],1)],1),s("el-tab-pane",{attrs:{label:e.$t("schedule.task_notification"),name:"second"}},[s("schedule-task-notification",{attrs:{"test-id":e.testId,"schedule-receiver-options":e.scheduleReceiverOptions}})],1)],1)],1)]],2)},o=[],r=(s("8fec"),s("495f")),l=s("1cff"),c=s("ab53"),d=s("a215"),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",[s("el-col",{attrs:{span:20}},[s("el-button",{attrs:{icon:"el-icon-circle-plus-outline",plain:"",size:"mini"},on:{click:e.handleAddTaskModel}},[e._v(" "+e._s(e.$t("organization.message.create_new_notification"))+" ")]),s("el-popover",{attrs:{placement:"right-end",title:"示例",width:"600",trigger:"click"}},[s("ms-code-edit",{attrs:{"read-only":!0,height:"400px",data:e.title,modes:e.modes,mode:"html"},on:{"update:data":function(t){e.title=t}}}),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.mail_template_example"))+" ")])],1),s("el-popover",{attrs:{placement:"right-end",title:"示例",width:"200",trigger:"click"}},[s("ms-code-edit",{attrs:{"read-only":!0,height:"200px",data:e.robotTitle,modes:e.modes,mode:"text"},on:{"update:data":function(t){e.robotTitle=t}}}),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.robot_template"))+" ")])],1)],1)],1),s("el-row",[s("el-col",{attrs:{span:24}},[s("el-table",{staticClass:"tb-edit",attrs:{data:e.scheduleTask,border:"","cell-style":e.rowClass,"header-cell-style":e.headClass}},[s("el-table-column",{attrs:{label:e.$t("schedule.event"),prop:"events","min-width":"13%"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{attrs:{size:"mini",placeholder:e.$t("organization.message.select_events"),prop:"events",disabled:!t.row.isSet},model:{value:t.row.event,callback:function(s){e.$set(t.row,"event",s)},expression:"scope.row.event"}},e._l(e.scheduleEventOptions,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),s("el-table-column",{attrs:{label:e.$t("schedule.receiver"),prop:"userIds","min-width":"18%"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[s("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",size:"mini",placeholder:e.$t("commons.please_select"),disabled:!i.isSet},model:{value:i.userIds,callback:function(t){e.$set(i,"userIds",t)},expression:"row.userIds"}},e._l(e.scheduleReceiverOptions,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),s("el-table-column",{attrs:{label:e.$t("schedule.receiving_mode"),prop:"type","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{attrs:{placeholder:e.$t("organization.message.select_receiving_method"),size:"mini",disabled:!t.row.isSet},on:{change:function(s){return e.handleEdit(t.$index,t.row)}},model:{value:t.row.type,callback:function(s){e.$set(t.row,"type",s)},expression:"scope.row.type"}},e._l(e.receiveTypeOptions,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),s("el-table-column",{attrs:{label:"webhook","min-width":"20%",prop:"webhook"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-input",{attrs:{placeholder:"webhook地址",size:"mini",disabled:!t.row.isSet||!t.row.isReadOnly},model:{value:t.row.webhook,callback:function(s){e.$set(t.row,"webhook",s)},expression:"scope.row.webhook"}})]}}])}),s("el-table-column",{attrs:{label:e.$t("commons.operating"),prop:"result","min-width":"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSet?s("el-button",{directives:[{name:"xpack",rawName:"v-xpack"}],attrs:{type:"success",size:"mini"},on:{click:function(s){return e.handleTemplate(t.$index,t.row)}}},[e._v(e._s(e.$t("organization.message.template"))+" ")]):e._e(),s("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.isSet,expression:"scope.row.isSet"}],attrs:{type:"primary",size:"mini"},on:{click:function(s){return e.handleAddTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.add"))+" ")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.isSet,expression:"scope.row.isSet"}],attrs:{size:"mini"},nativeOn:{click:function(s){return s.preventDefault(),e.removeRowTask(t.$index,e.scheduleTask)}}},[e._v(e._s(e.$t("commons.cancel"))+" ")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"}],attrs:{type:"primary",size:"mini"},on:{click:function(s){return e.handleEditTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.edit"))+" ")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},nativeOn:{click:function(s){return s.preventDefault(),e.deleteRowTask(t.$index,t.row)}}})]}}])})],1)],1)],1),s("notice-template",{directives:[{name:"xpack",rawName:"v-xpack"}],ref:"noticeTemplate"})],1)},p=[],m=(s("89a8"),s("fe35"),s("993f"),s("2278")),f=s("cfb0"),h=f.keys().length>0?f("./notice/NoticeTemplate.vue"):{},v={name:"ScheduleTaskNotification",components:{MsCodeEdit:m["a"],NoticeTemplate:h.default},props:{testId:String,scheduleReceiverOptions:Array,isTesterPermission:{type:Boolean,default:!0}},data:function(){return{modes:["text","html"],title:'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>MeterSphere</title>\n</head>\n<body>\n<div>\n    <div style="text-align: left">\n        <p>尊敬的用户：</p>\n        <p style="margin-left: 60px">您好:\n    </div>\n    <div style="margin-left: 100px">\n        <p>${testName} 接口测试运行失败/成功<br/>\n        <p>执行人:${executor}</p>        <p>负责人:${principal}</p>        <p>执行环境:${executionEnvironment}</p>        <p>执行时间:${executionTime}</p>            请点击下面链接进入测试报告页面</p>\n        <a href="${url}/#/${type}/report/view/${id}">${url}/#/${type}/report/view/${id}</a>\n        <p>新版接口测试报告路径</p>\n        <a href="${url}/#/api/automation/report/view/">${url}/#/api/automation/report/view/${id}</a>\n    </div>\n\n</div>\n</body>\n</html>',robotTitle:"测试【任务通知】:'${testName} ${type}测试运行${status},\n执行人:${executor}\n负责人:${principal}\n测试环境为:${executionEnvironment}\n执行时间：${executionTime}\n请点击下面链接进入测试报告页面\n${url}/#/${type}/report/view/${id}\n新版接口测试报告路径\n${url}/#/api/automation/report/view/${id}",scheduleTask:[{taskType:"scheduleTask",event:"",userIds:[],type:[],webhook:"",isSet:!0,identification:"",isReadOnly:!1,testId:this.testId}],scheduleEventOptions:[{value:"EXECUTE_SUCCESSFUL",label:this.$t("schedule.event_success")},{value:"EXECUTE_FAILED",label:this.$t("schedule.event_failed")}],receiveTypeOptions:[{value:"EMAIL",label:this.$t("organization.message.mail")},{value:"NAIL_ROBOT",label:this.$t("organization.message.nail_robot")},{value:"WECHAT_ROBOT",label:this.$t("organization.message.enterprise_wechat_robot")},{value:"LARK",label:this.$t("organization.message.lark")}]}},mounted:function(){this.initForm()},methods:{initForm:function(){var e=this;this.result=this.$get("/notice/search/message/"+this.testId,(function(t){e.scheduleTask=t.data}))},handleEdit:function(e,t){t.isReadOnly=!0,"EMAIL"===t.type&&(t.isReadOnly=!t.isReadOnly,t.webhook="")},handleAddTaskModel:function(){var e={event:[],userIds:[],type:"",webhook:"",isSet:!0,identification:"",taskType:"SCHEDULE_TASK"};e.testId=this.testId,this.scheduleTask.push(e)},handleEditTask:function(e,t){t.isSet=!0,t.testId=this.testId,"EMAIL"===t.type?(t.isReadOnly=!1,t.webhook=""):t.isReadOnly=!0},handleAddTask:function(e,t){t.event&&t.userIds.length>0&&t.type?"NAIL_ROBOT"===t.type||"WECHAT_ROBOT"===t.type||"LARK"===t.type?t.webhook?this.addTask(t):this.$warning(this.$t("organization.message.message_webhook")):this.addTask(t):this.$warning(this.$t("organization.message.message"))},addTask:function(e){var t=this;this.result=this.$post("/notice/save/message/task",e,(function(){t.initForm(),t.$success(t.$t("commons.save_success"))}))},removeRowTask:function(e,t){t[e].identification?t[e].isSet=!1:t.splice(e,1)},deleteRowTask:function(e,t){var s=this;this.result=this.$get("/notice/delete/message/"+t.identification,(function(e){s.$success(s.$t("commons.delete_success")),s.initForm()}))},rowClass:function(){return"text-align:center"},headClass:function(){return"text-align:center;background:'#ededed'"},handleTemplate:function(e,t){Object(r["p"])()&&this.$refs.noticeTemplate.open(t)}},watch:{testId:function(){this.initForm()}}},b=v,g=(s("eda4"),s("cba8")),_=Object(g["a"])(b,u,p,!1,null,"853fac24",null),w=_.exports;function $(){return{pass:!0}}var y={name:"MsScheduleEdit",components:{CrontabResult:c["a"],Crontab:l["a"],ScheduleTaskNotification:w},props:{testId:String,save:Function,schedule:{},customValidate:{type:Function,default:$},isReadOnly:{type:Boolean,default:!1}},watch:{"schedule.value":function(){this.form.cronValue=this.schedule.value}},data:function(){var e=this,t=function(t,s,i){var n=e.customValidate(e.getIntervalTime());s?Object(d["a"])(s)?n.pass?i():i(new Error(n.info)):i(new Error(e.$t("schedule.cron_expression_format_error"))):i(new Error(e.$t("commons.input_content")))};return{scheduleReceiverOptions:[],operation:!0,dialogVisible:!1,showCron:!1,form:{cronValue:""},activeName:"first",rules:{cronValue:[{required:!0,validator:t,trigger:"blur"}]}}},methods:{currentUser:function(){return Object(r["h"])()},initUserList:function(){var e=this,t={name:"",organizationId:Object(r["f"])()};this.result=this.$post("user/org/member/list/all",t,(function(t){e.scheduleReceiverOptions=t.data}))},buildParam:function(){var e={};return e.notices=this.tableData,e.testId=this.testId,e},open:function(){this.initUserList(),this.dialogVisible=!0,this.form.cronValue=this.schedule.value,Object(r["v"])(this.close),this.activeName="first"},crontabFill:function(e,t){this.form.cronValue=e,this.$refs.crontabResult.resultList=t,this.$refs["from"].validate()},showCronDialog:function(){this.showCron=!0},saveCron:function(){var e=this;this.$refs["from"].validate((function(t){if(!t)return!1;e.intervalShortValidate(),e.save(e.form.cronValue),e.dialogVisible=!1}))},saveNotice:function(){var e=this,t=this.buildParam();this.result=this.$post("notice/save",t,(function(){e.$success(e.$t("commons.save_success"))}))},close:function(){this.dialogVisible=!1,this.form.cronValue="",this.$refs["from"].resetFields(),this.schedule.value||(this.$refs.crontabResult.resultList=[]),Object(r["z"])(this.close)},intervalShortValidate:function(){return this.getIntervalTime()<18e4&&this.$info(this.$t("schedule.cron_expression_interval_short_error")),!0},resultListChange:function(){this.$refs["from"].validate()},getIntervalTime:function(){var e=this.$refs.crontabResult.resultList,t=new Date(e[0]),s=new Date(e[1]);return s-t}},computed:{isTesterPermission:function(){return!1}}},k=y,x=(s("ffcb"),Object(g["a"])(k,a,o,!1,null,"95a156c0",null)),E=x.exports;function C(){return{pass:!0}}var S={name:"MsScheduleConfig",components:{CrontabResult:c["a"],MsScheduleEdit:E},data:function(){return{recentList:[],refreshScheduler:null}},props:{testId:String,save:Function,schedule:{},checkOpen:{type:Function,default:function(){return{checkOpen:function(){return!0}}}},customValidate:{type:Function,default:C},isReadOnly:{type:Boolean,default:!1}},methods:{scheduleEdit:function(){this.checkOpen()&&this.$refs.scheduleEdit.open()},scheduleChange:function(){this.$emit("scheduleChange")},flashResultList:function(){this.$refs.crontabResult&&this.$refs.crontabResult.expressionChange()},cancelRefresh:function(){this.refreshScheduler&&clearInterval(this.refreshScheduler)}},beforeDestroy:function(){this.cancelRefresh()},watch:{schedule:function(){this.schedule.enable?this.refreshScheduler=setInterval(this.flashResultList,2e3):this.cancelRefresh()}}},I=S,O=(s("3f79"),Object(g["a"])(I,i,n,!1,null,"6e6cd134",null));t["a"]=O.exports},ffcb:function(e,t,s){"use strict";s("b79f")}}]);