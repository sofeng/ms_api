(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-795bcb49"],{"02b6":function(t,e,n){"use strict";n("f277")},23533:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.result.loading,expression:"result.loading"}],staticClass:"table-card",scopedSlots:t._u([{key:"header",fn:function(){return[n("ms-table-header",{attrs:{"create-permission":["WORKSPACE_PROJECT_ENVIRONMENT:READ+CREATE"],title:t.$t("api_test.environment.environment_list"),"create-tip":t.btnTips,condition:t.condition},on:{"update:condition":function(e){t.condition=e},search:t.search,create:t.createEnv},scopedSlots:t._u([{key:"button",fn:function(){return[n("ms-table-button",{directives:[{name:"permission",rawName:"v-permission",value:["WORKSPACE_PROJECT_ENVIRONMENT:READ+IMPORT"],expression:"['WORKSPACE_PROJECT_ENVIRONMENT:READ+IMPORT']"}],attrs:{icon:"el-icon-box",content:t.$t("commons.import")},on:{click:t.importJSON}}),n("ms-table-button",{directives:[{name:"permission",rawName:"v-permission",value:["WORKSPACE_PROJECT_ENVIRONMENT:READ+EXPORT"],expression:"['WORKSPACE_PROJECT_ENVIRONMENT:READ+EXPORT']"}],attrs:{icon:"el-icon-box",content:t.$t("commons.export")},on:{click:t.exportJSON}})]},proxy:!0}])})]},proxy:!0}])},[n("el-table",{ref:"table",staticClass:"adjust-table",staticStyle:{width:"100%"},attrs:{border:"",data:t.environments,height:t.screenHeight},on:{"filter-change":t.filter,"selection-change":t.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection"}}),n("el-table-column",{attrs:{label:t.$t("commons.project"),width:"250",filters:t.projectFilters,"column-key":"projectId","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(t.idNameMap.get(e.row.projectId)))])]}}])}),n("el-table-column",{attrs:{label:t.$t("api_test.environment.name"),prop:"name","show-overflow-tooltip":""}}),n("el-table-column",{attrs:{label:t.$t("api_test.environment.socket"),"show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return["SHOW_INFO"!=t.parseDomainName(e.row)?n("span",[t._v(t._s(t.parseDomainName(e.row)))]):n("el-button",{attrs:{size:"mini",icon:"el-icon-s-data"},on:{click:function(n){return t.showInfo(e.row)}}},[t._v("查看域名详情")])]}}])}),n("el-table-column",{attrs:{label:t.$t("commons.operating")},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",[n("ms-table-operator",{attrs:{"edit-permission":["WORKSPACE_PROJECT_ENVIRONMENT:READ+EDIT"],"delete-permission":["WORKSPACE_PROJECT_ENVIRONMENT:READ+DELETE"]},on:{editClick:function(n){return t.editEnv(e.row)},deleteClick:function(n){return t.deleteEnv(e.row)}},scopedSlots:t._u([{key:"middle",fn:function(){return[n("ms-table-operator-button",{directives:[{name:"permission",rawName:"v-permission",value:["WORKSPACE_PROJECT_ENVIRONMENT:READ+COPY"],expression:"['WORKSPACE_PROJECT_ENVIRONMENT:READ+COPY']"}],attrs:{tip:t.$t("commons.copy"),icon:"el-icon-document-copy",type:"info"},on:{exec:function(n){return t.copyEnv(e.row)}}})]},proxy:!0}],null,!0)})],1)]}}])})],1),n("ms-table-pagination",{attrs:{change:t.list,"current-page":t.currentPage,"page-size":t.pageSize,total:t.total},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e}}})],1),n("el-dialog",{attrs:{visible:t.dialogVisible,"close-on-click-modal":!1,title:t.dialogTitle,width:"66%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("div",{staticClass:"project-item"},[n("div",[t._v(" "+t._s(t.$t("project.select"))+" ")]),n("el-select",{attrs:{filterable:"",clearable:""},on:{change:t.handleProjectChange},model:{value:t.currentProjectId,callback:function(e){t.currentProjectId=e},expression:"currentProjectId"}},t._l(t.projectList,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),n("environment-edit",{ref:"environmentEdit",attrs:{environment:t.currentEnvironment,"project-id":t.currentProjectId},on:{close:t.close,refreshAfterSave:t.refresh}})],1),n("environment-import",{ref:"envImport",attrs:{"project-list":t.projectList},on:{refresh:t.refresh}}),n("el-dialog",{attrs:{title:"域名列表",visible:t.domainVisible},on:{"update:visible":function(e){t.domainVisible=e}}},[n("el-table",{attrs:{data:t.conditions}},[n("el-table-column",{attrs:{prop:"socket",label:t.$t("load_test.domain"),"show-overflow-tooltip":"",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.getUrl(n))+" ")]}}])}),n("el-table-column",{attrs:{prop:"type",label:t.$t("api_test.environment.condition_enable"),"show-overflow-tooltip":"","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.getName(n))+" ")]}}])}),n("el-table-column",{attrs:{prop:"details","show-overflow-tooltip":"","min-width":"120px",label:t.$t("api_test.value")},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(" "+t._s(t.getDetails(n))+" ")]}}])}),n("el-table-column",{attrs:{prop:"createTime","show-overflow-tooltip":"","min-width":"120px",label:t.$t("commons.create_time")},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[n("span",[t._v(t._s(t._f("timestampFormatDate")(i.time)))])]}}])})],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:function(e){t.domainVisible=!1}}},[t._v(t._s(t.$t("commons.cancel")))]),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.domainVisible=!1}}},[t._v(t._s(t.$t("commons.confirm")))])],1)],1)],1)},o=[],s=(n("bb13"),n("89a8"),n("b110"),n("fe35"),n("1a91"),n("10dd"),n("d1cf"),n("87d5"),n("8ea3"),n("5a05"),n("10b9")),r=n("ae75"),a=n("1c98"),l=n("be8e"),c=n("59d9"),d=n("c134"),p=n("4f86"),u=n("e56a"),m=n("a3b4"),f=n("8804"),h=n("abe6"),v=n("9b14"),_=n("495f"),g=n("78e0"),b={name:"EnvironmentList",components:{EnvironmentImport:g["a"],SearchList:v["a"],ProjectSwitch:h["a"],MsAsideContainer:f["a"],MsAsideItem:m["a"],EnvironmentEdit:u["a"],ApiEnvironmentConfig:d["a"],MsTablePagination:c["a"],MsTableOperatorButton:l["a"],MsTableOperator:a["a"],MsTableButton:r["a"],MsTableHeader:s["a"]},data:function(){return{btnTips:this.$t("api_test.environment.create"),projectList:[],condition:{},environments:[],currentEnvironment:new p["b"],result:{},dialogVisible:!1,idNameMap:new Map,dialogTitle:"",currentProjectId:"",selectRows:[],isTesterPermission:!1,domainVisible:!1,conditions:[],currentPage:1,pageSize:10,total:0,projectIds:[],projectFilters:[],screenHeight:"calc(100vh - 195px)"}},created:function(){},activated:function(){this.list()},watch:{currentProjectId:function(){""===this.currentProjectId?this.currentEnvironment.projectId=null:this.currentEnvironment.projectId=this.currentProjectId}},methods:{showInfo:function(t){var e=JSON.parse(t.config);this.conditions=e.httpConfig.conditions,this.domainVisible=!0},getName:function(t){switch(t.type){case"NONE":return this.$t("api_test.definition.document.data_set.none");case"MODULE":return this.$t("test_track.module.module");case"PATH":return this.$t("api_test.definition.api_path")}},getUrl:function(t){return t.protocol+"://"+t.socket},getDetails:function(t){if(!t||"MODULE"!==t.type)return t&&"PATH"===t.type&&t.details.length>0&&t.details[0].name?"equals"===t.details[0].value?this.$t("commons.adv_search.operators.equals")+t.details[0].name:this.$t("api_test.request.assertions.contains")+t.details[0].name:"";if(t.details&&t.details instanceof Array){var e="";return t.details.forEach((function(t){e+=t.name+","})),e.endsWith(",")&&(e=e.substr(0,e.length-1)),e}},list:function(){var t=this;this.projectList&&0!==this.projectList.length?this.getEnvironments():this.$get("/project/listAll",(function(e){t.projectList=e.data,t.projectList.forEach((function(e){t.idNameMap.set(e.id,e.name),t.projectIds.push(e.id),t.projectFilters.push({text:e.name,value:e.id})})),t.getEnvironments()}))},getEnvironments:function(t){var e=this;this.environments=[],t&&t.length>0?this.condition.projectIds=t:this.condition.projectIds=this.projectIds;var n="/api/environment/list/"+this.currentPage+"/"+this.pageSize;this.result=this.$post(n,this.condition,(function(t){e.environments=t.data.listObject,e.total=t.data.itemCount}))},createEnv:function(){this.currentProjectId="",this.dialogTitle=this.$t("api_test.environment.create"),this.dialogVisible=!0,this.currentEnvironment=new p["b"]},search:function(){this.list()},editEnv:function(t){this.dialogTitle=this.$t("api_test.environment.config_environment"),this.currentProjectId=t.projectId;var e={};Object.assign(e,t),Object(p["e"])(e),this.currentEnvironment=e,this.dialogVisible=!0},copyEnv:function(t){this.currentProjectId=t.projectId,this.dialogTitle=this.$t("api_test.environment.copy_environment");var e={};Object.assign(e,t),Object(p["e"])(e);var n=new p["b"](e);n.id=null,n.name=this.getNoRepeatName(n.name),this.dialogVisible=!0,this.currentEnvironment=n},deleteEnv:function(t){var e=this;t.id&&this.$confirm(this.$t("commons.confirm_delete")+t.name,{confirmButtonText:this.$t("commons.confirm"),cancelButtonText:this.$t("commons.cancel"),type:"warning"}).then((function(){e.result=e.$get("/api/environment/delete/"+t.id,(function(){e.$success(e.$t("commons.delete_success")),e.list()}))})).catch((function(){e.$info(e.$t("commons.delete_cancelled"))}))},getNoRepeatName:function(t){for(var e in this.environments)if(this.environments[e].name===t)return this.getNoRepeatName(t+" copy");return t},filter:function(t){this.getEnvironments(t.projectId)},close:function(){this.dialogVisible=!1,this.$refs.environmentEdit.clearValidate()},refresh:function(){this.list()},handleSelectionChange:function(t){this.selectRows=t},importJSON:function(){this.$refs.envImport.open()},exportJSON:function(){if(this.selectRows.length<1)this.$warning(this.$t("api_test.environment.select_environment"));else{var t=JSON.parse(JSON.stringify(this.selectRows));t.map((function(t){if(t.config){var e=JSON.parse(t.config);e.httpConfig.conditions&&e.httpConfig.conditions.length>0&&(e.httpConfig.conditions=e.httpConfig.conditions.filter((function(t){return"MODULE"!==t.type})),t.config=JSON.stringify(e))}delete t.id,delete t.projectId})),Object(_["b"])("MS_"+t.length+"_Environments.json",JSON.stringify(t))}},handleProjectChange:function(){this.currentEnvironment.config.httpConfig.conditions=[]},parseDomainName:function(t){if(!t.config)return t.protocol+"://"+t.domain;var e=JSON.parse(t.config);if(e.httpConfig&&!e.httpConfig.conditions)return e.httpConfig.protocol&&e.httpConfig.domain?e.httpConfig.protocol+"://"+e.httpConfig.domain:"";if(1!==e.httpConfig.conditions.length)return e.httpConfig.conditions.length>1?"SHOW_INFO":"";var n=e.httpConfig.conditions[0];return n.protocol&&n.domain?n.protocol+"://"+n.domain:void 0}}},E=b,j=(n("a269"),n("cba8")),w=Object(j["a"])(E,i,o,!1,null,"21cf11ce",null);e["default"]=w.exports},"78e0":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{visible:t.dialogVisible,title:t.dialogTitle,"close-on-click-modal":!1,width:"50%"},on:{close:t.close},scopedSlots:t._u([{key:"footer",fn:function(){return[n("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v(" "+t._s(t.$t("commons.confirm"))+" ")])]},proxy:!0}])},[n("el-form",[n("el-row",[n("el-col",{attrs:{span:6}},[n("div",{staticClass:"project-item"},[n("div",{staticStyle:{"margin-bottom":"10px"}},[t._v(" "+t._s(t.$t("project.select"))+" ")]),n("el-select",{attrs:{filterable:"",clearable:""},model:{value:t.currentProjectId,callback:function(e){t.currentProjectId=e},expression:"currentProjectId"}},t._l(t.projectList,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1)]),n("el-col",{attrs:{span:16,offset:1}},[n("el-upload",{staticClass:"api-upload",attrs:{drag:"",action:"alert","on-change":t.handleFileChange,limit:1,"file-list":t.uploadFiles,"on-remove":t.handleRemove,"on-exceed":t.handleExceed,"auto-upload":!1,accept:".json"}},[n("i",{staticClass:"el-icon-upload"}),n("div",{staticClass:"el-upload__text",domProps:{innerHTML:t._s(t.$t("load_test.upload_tips"))}}),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" "+t._s(t.$t("api_test.api_import.file_size_limit"))+" "+t._s("，"+t.$t("api_test.api_import.ms_env_import_file_limit"))+" ")])])],1)],1)],1)],1)},o=[],s=(n("8ea3"),n("10dd"),{name:"EnvironmentImport",props:{projectList:{type:Array,default:function(){return[]}}},data:function(){return{currentProjectId:"",uploadFiles:[],dialogTitle:this.$t("api_test.environment.import"),dialogVisible:!1}},watch:{dialogVisible:function(t,e){!1===e&&(this.currentProjectId="",this.uploadFiles=[])}},methods:{handleFileChange:function(t,e){this.uploadFiles=e},save:function(){var t=this;if(this.uploadFiles.length>0)for(var e=0;e<this.uploadFiles.length;e++){this.uploadValidate(this.uploadFiles[e]);var n=this.uploadFiles[e];if(n){var i=new FileReader;i.readAsText(n.raw),i.onload=function(e){var n=e.target.result;try{JSON.parse(n).map((function(e){e.projectId=""===t.currentProjectId?null:t.currentProjectId,t.$fileUpload("/api/environment/add",null,[],e,(function(e){t.$emit("refresh"),t.$success(t.$t("commons.save_success"))}))}))}catch(i){t.$warning(t.$t("api_test.api_import.ms_env_import_file_limit"))}}}}},handleExceed:function(){this.$warning(this.$t("api_test.api_import.file_exceed_limit"))},handleRemove:function(){},uploadValidate:function(t){var e=t.name.substring(t.name.lastIndexOf(".")+1);"json"!==e&&this.$warning(this.$t("api_test.api_import.ms_env_import_file_limit")),t.size/1024/1024>20&&this.$warning(this.$t("api_test.api_import.file_size_limit"))},open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1}}}),r=s,a=(n("02b6"),n("cba8")),l=Object(a["a"])(r,i,o,!1,null,"a4eed5e4",null);e["a"]=l.exports},a269:function(t,e,n){"use strict";n("f72a")},f277:function(t,e,n){},f72a:function(t,e,n){}}]);