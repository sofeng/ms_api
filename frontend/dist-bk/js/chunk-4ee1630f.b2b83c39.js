(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ee1630f"],{"232a":function(e,t,o){"use strict";o("7dfb")},"7dfb":function(e,t,o){},bbe8:function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}]},[o("el-card",{staticClass:"table-card",scopedSlots:e._u([{key:"header",fn:function(){return[o("ms-table-header",{attrs:{"create-permission":["SYSTEM_ORGANIZATION:READ+CREATE"],condition:e.condition,"create-tip":e.$t("organization.create"),title:e.$t("commons.organization")},on:{"update:condition":function(t){e.condition=t},search:e.initTableData,create:e.create}})]},proxy:!0}])},[o("el-table",{staticClass:"adjust-table",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData,height:e.screenHeight}},[o("el-table-column",{attrs:{prop:"name",label:e.$t("commons.name")}}),o("el-table-column",{attrs:{prop:"description",label:e.$t("commons.description")}}),o("el-table-column",{attrs:{label:e.$t("commons.member")},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-link",{staticClass:"member-size",attrs:{type:"primary"},on:{click:function(o){return e.cellClick(t.row)}}},[e._v(" "+e._s(t.row.memberSize)+" ")])]}}])}),o("el-table-column",{attrs:{label:e.$t("commons.operating")},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",[o("ms-table-operator",{attrs:{"edit-permission":["SYSTEM_ORGANIZATION:READ+EDIT"],"delete-permission":["SYSTEM_ORGANIZATION:READ+DELETE"],"show-delete":e.organizationId!==t.row.id},on:{editClick:function(o){return e.edit(t.row)},deleteClick:function(o){return e.handleDelete(t.row)}}})],1)]}}])})],1),o("ms-table-pagination",{attrs:{change:e.initTableData,"current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t}}})],1),o("el-dialog",{staticClass:"dialog-css",attrs:{"close-on-click-modal":!1,visible:e.dialogOrgMemberVisible,width:"70%","destroy-on-close":!0},on:{"update:visible":function(t){e.dialogOrgMemberVisible=t},close:e.closeFunc},scopedSlots:e._u([{key:"title",fn:function(){return[o("ms-table-header",{attrs:{condition:e.dialogCondition,"create-tip":e.$t("member.create"),title:e.$t("commons.member")},on:{"update:condition":function(t){e.dialogCondition=t},create:e.addMember,search:e.dialogSearch}})]},proxy:!0}])},[o("el-table",{staticClass:"adjust-table",staticStyle:{width:"100%","margin-top":"5px"},attrs:{border:!0,data:e.memberLineData}},[o("el-table-column",{attrs:{prop:"id",label:"ID"}}),o("el-table-column",{attrs:{prop:"name",label:e.$t("commons.username")}}),o("el-table-column",{attrs:{prop:"email",label:e.$t("commons.email")}}),o("el-table-column",{attrs:{prop:"phone",label:e.$t("commons.phone")}}),o("el-table-column",{attrs:{label:e.$t("commons.group"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(e){return[o("ms-roles-tag",{attrs:{roles:e.row.groups}})]}}])}),o("el-table-column",{attrs:{label:e.$t("commons.operating")},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",[o("ms-table-operator",{attrs:{tip2:e.$t("commons.remove")},on:{editClick:function(o){return e.editMember(t.row)},deleteClick:function(o){return e.delMember(t.row)}}})],1)]}}])})],1),o("ms-table-pagination",{attrs:{change:e.dialogSearch,"current-page":e.dialogCurrentPage,"page-size":e.dialogPageSize,total:e.dialogTotal},on:{"update:currentPage":function(t){e.dialogCurrentPage=t},"update:current-page":function(t){e.dialogCurrentPage=t},"update:pageSize":function(t){e.dialogPageSize=t},"update:page-size":function(t){e.dialogPageSize=t}}})],1),o("el-dialog",{attrs:{"close-on-click-modal":!1,title:e.$t("organization.create"),visible:e.dialogOrgAddVisible,width:"30%","destroy-on-close":!0},on:{"update:visible":function(t){e.dialogOrgAddVisible=t},closed:e.closeFunc},scopedSlots:e._u([{key:"footer",fn:function(){return[o("ms-dialog-footer",{on:{cancel:function(t){e.dialogOrgAddVisible=!1},confirm:function(t){return e.createOrganization("createOrganization")}}})]},proxy:!0}])},[o("el-form",{ref:"createOrganization",attrs:{model:e.form,"label-position":"right","label-width":"100px",size:"small",rules:e.rule}},[o("el-form-item",{attrs:{label:e.$t("commons.name"),prop:"name"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),o("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]})],1),o("el-form-item",{attrs:{label:e.$t("commons.description"),prop:"description"}},[o("el-input",{attrs:{autocomplete:"off",type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1),o("el-dialog",{attrs:{"close-on-click-modal":!1,title:e.$t("organization.modify"),visible:e.dialogOrgUpdateVisible,width:"30%","destroy-on-close":!0},on:{"update:visible":function(t){e.dialogOrgUpdateVisible=t},close:e.closeFunc},scopedSlots:e._u([{key:"footer",fn:function(){return[o("ms-dialog-footer",{on:{cancel:function(t){e.dialogOrgUpdateVisible=!1},confirm:function(t){return e.updateOrganization("updateOrganizationForm")}}})]},proxy:!0}])},[o("el-form",{ref:"updateOrganizationForm",attrs:{model:e.form,"label-position":"right","label-width":"100px",size:"small",rules:e.rule}},[o("el-form-item",{attrs:{label:e.$t("commons.name"),prop:"name"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),o("el-form-item",{attrs:{label:e.$t("commons.description"),prop:"description"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1),o("add-member",{ref:"addMember",attrs:{"group-type":"ORGANIZATION","group-scope-id":e.orgId},on:{submit:e.submitForm}}),o("el-dialog",{attrs:{"close-on-click-modal":!1,title:e.$t("member.modify"),visible:e.dialogOrgMemberUpdateVisible,width:"30%","destroy-on-close":!0},on:{"update:visible":function(t){e.dialogOrgMemberUpdateVisible=t},close:e.closeFunc},scopedSlots:e._u([{key:"footer",fn:function(){return[o("ms-dialog-footer",{on:{cancel:function(t){e.dialogOrgMemberUpdateVisible=!1},confirm:function(t){return e.updateOrgMember("updateUserForm")}}})]},proxy:!0}])},[o("el-form",{ref:"updateUserForm",attrs:{model:e.memberForm,"label-position":"right","label-width":"100px",size:"small"}},[o("el-form-item",{attrs:{label:"ID",prop:"id"}},[o("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:e.memberForm.id,callback:function(t){e.$set(e.memberForm,"id",t)},expression:"memberForm.id"}})],1),o("el-form-item",{attrs:{label:e.$t("commons.username"),prop:"name"}},[o("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:e.memberForm.name,callback:function(t){e.$set(e.memberForm,"name",t)},expression:"memberForm.name"}})],1),o("el-form-item",{attrs:{label:e.$t("commons.email"),prop:"email"}},[o("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:e.memberForm.email,callback:function(t){e.$set(e.memberForm,"email",t)},expression:"memberForm.email"}})],1),o("el-form-item",{attrs:{label:e.$t("commons.phone"),prop:"phone"}},[o("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:e.memberForm.phone,callback:function(t){e.$set(e.memberForm,"phone",t)},expression:"memberForm.phone"}})],1),o("el-form-item",{attrs:{label:e.$t("commons.group"),prop:"groupIds",rules:{required:!0,message:e.$t("group.please_select_group"),trigger:"change"}}},[o("el-select",{staticClass:"select-width",attrs:{filterable:"",multiple:"",placeholder:e.$t("group.please_select_group")},model:{value:e.memberForm.groupIds,callback:function(t){e.$set(e.memberForm,"groupIds",t)},expression:"memberForm.groupIds"}},e._l(e.memberForm.allgroups,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),o("ms-delete-confirm",{ref:"deleteConfirm",attrs:{title:e.$t("organization.delete")},on:{delete:e._handleDelete}})],1)},a=[],r=(o("5a05"),o("89a8"),o("8ea3"),o("10dd"),o("978f")),n=o("59d9"),s=o("10b9"),l=o("2edc"),m=o("1c98"),c=o("be8e"),d=o("15bc"),u=o("495f"),p=o("4abd"),g=o("a369"),b=o("bcc4"),f={name:"MsOrganization",components:{MsDeleteConfirm:g["a"],MsCreateBox:r["a"],MsTablePagination:n["a"],MsTableHeader:s["a"],MsRolesTag:l["a"],MsTableOperator:m["a"],MsDialogFooter:d["a"],MsTableOperatorButton:c["a"],AddMember:b["a"]},computed:{organizationId:function(){return Object(u["f"])()}},inject:["reloadTopMenus"],data:function(){return{queryPath:"/organization/list",deletePath:"/organization/delete/",createPath:"/organization/add",updatePath:"/organization/update",result:{},dialogOrgAddVisible:!1,dialogOrgUpdateVisible:!1,dialogOrgMemberVisible:!1,dialogOrgMemberAddVisible:!1,dialogOrgMemberUpdateVisible:!1,multipleSelection:[],currentPage:1,pageSize:10,total:0,dialogCurrentPage:1,dialogPageSize:5,dialogTotal:0,currentRow:{},screenHeight:"calc(100vh - 195px)",condition:{},dialogCondition:{},tableData:[],memberLineData:[],form:{},memberForm:{},rule:{name:[{required:!0,message:this.$t("organization.input_name"),trigger:"blur"},{min:2,max:25,message:this.$t("commons.input_limit",[2,25]),trigger:"blur"}],description:[{max:50,message:this.$t("commons.input_limit",[0,50]),trigger:"blur"}]},orgMemberRule:{userIds:[{required:!0,message:this.$t("member.please_choose_member"),trigger:["blur"]}],groupIds:[{required:!0,message:this.$t("group.please_select_group"),trigger:["blur"]}]},orgId:""}},activated:function(){this.initTableData()},methods:{create:function(){this.dialogOrgAddVisible=!0,Object(u["v"])(this.closeFunc)},addMember:function(){this.$refs.addMember.open()},dataFilter:function(e){this.memberForm.userList=e?this.memberForm.copyUserList.filter((function(t){if(~t.id.indexOf(e)||~t.id.toUpperCase().indexOf(e.toUpperCase()))return!0})):this.memberForm.copyUserList},edit:function(e){this.dialogOrgUpdateVisible=!0,this.form=Object.assign({},e),Object(u["v"])(this.closeFunc)},editMember:function(e){var t=this;this.dialogOrgMemberUpdateVisible=!0,this.memberForm=Object.assign({},e);var o=this.memberForm.groups.map((function(e){return e.id}));this.result=this.$post("/user/group/list",{type:p["i"],resourceId:this.orgId},(function(e){t.$set(t.memberForm,"allgroups",e.data)})),this.$set(this.memberForm,"groupIds",o),Object(u["v"])(this.closeFunc)},cellClick:function(e){var t=this;this.currentRow=e,this.dialogOrgMemberVisible=!0,this.orgId=e.id;var o={name:"",organizationId:e.id},i="/user/special/org/member/list";this.result=this.$post(i+"/"+this.dialogCurrentPage+"/"+this.dialogPageSize,o,(function(o){var i=o.data;t.memberLineData=i.listObject;for(var a="/user/group/list/org/"+e.id,r=function(e){t.$get(a+"/"+encodeURIComponent(t.memberLineData[e].id),(function(o){var i=o.data;t.$set(t.memberLineData[e],"groups",i)}))},n=0;n<t.memberLineData.length;n++)r(n);t.dialogTotal=i.itemCount})),Object(u["v"])(this.closeFunc)},dialogSearch:function(){var e=this,t=this.currentRow;this.dialogOrgMemberVisible=!0;var o=this.dialogCondition;this.$set(o,"organizationId",t.id);var i="/user/special/org/member/list";this.result=this.$post(i+"/"+this.dialogCurrentPage+"/"+this.dialogPageSize,o,(function(o){var i=o.data;e.memberLineData=i.listObject;t.id;for(var a=function(t){e.result=e.$post("/user/group/list",{type:p["i"],resourceId:e.memberLineData[t].id},(function(o){e.$set(e.memberLineData[t],"groups",o.data)}))},r=0;r<e.memberLineData.length;r++)a(r);e.dialogTotal=i.itemCount}))},handleDelete:function(e){this.$refs.deleteConfirm.open(e)},_handleDelete:function(e){var t=this;this.$confirm(this.$t("organization.delete_confirm"),"",{confirmButtonText:this.$t("commons.confirm"),cancelButtonText:this.$t("commons.cancel"),type:"warning"}).then((function(){t.result=t.$get(t.deletePath+e.id,(function(){t.$success(t.$t("commons.delete_success")),t.reloadTopMenus()}))})).catch((function(){t.$message({type:"info",message:t.$t("commons.delete_cancelled")})}))},delMember:function(e){var t=this;this.$confirm(this.$t("member.remove_member"),"",{confirmButtonText:this.$t("commons.confirm"),cancelButtonText:this.$t("commons.cancel"),type:"warning"}).then((function(){t.result=t.$get("/user/special/org/member/delete/"+t.currentRow.id+"/"+encodeURIComponent(e.id),(function(){t.$success(t.$t("commons.remove_success")),t.cellClick(t.currentRow)}))})).catch((function(){t.$info(t.$t("commons.remove_cancel"))}))},createOrganization:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.result=t.$post(t.createPath,t.form,(function(){t.$success(t.$t("commons.save_success")),t.reloadTopMenus(),t.dialogOrgAddVisible=!1}))}))},updateOrganization:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.result=t.$post(t.updatePath,t.form,(function(){t.$success(t.$t("commons.modify_success")),t.dialogOrgUpdateVisible=!1,t.initTableData()}))}))},initTableData:function(){var e=this;this.result=this.$post(this.queryPath+"/"+this.currentPage+"/"+this.pageSize,this.condition,(function(t){var o=t.data;e.tableData=o.listObject;for(var i=function(t){var o={name:"",organizationId:e.tableData[t].id},i="user/special/org/member/list/all";e.$post(i,o,(function(o){var i=o.data;e.$set(e.tableData[t],"memberSize",i.length)}))},a=0;a<e.tableData.length;a++)i(a);e.total=o.itemCount}))},closeFunc:function(){this.memberLineData=[],this.initTableData(),this.form={},Object(u["z"])(this.closeFunc),this.dialogOrgAddVisible=!1,this.dialogOrgUpdateVisible=!1,this.dialogOrgMemberVisible=!1,this.dialogOrgMemberAddVisible=!1,this.dialogOrgMemberUpdateVisible=!1},handleSelectionChange:function(e){this.multipleSelection=e},submitForm:function(e){var t=this;e["organizationId"]=this.currentRow.id,this.result=this.$post("user/special/org/member/add",e,(function(){t.cellClick(t.currentRow),t.$refs.addMember.close()}))},updateOrgMember:function(e){var t=this,o={id:this.memberForm.id,name:this.memberForm.name,email:this.memberForm.email,phone:this.memberForm.phone,groupIds:this.memberForm.groupIds,organizationId:this.currentRow.id};this.$refs[e].validate((function(e){e&&(t.result=t.$post("/organization/member/update",o,(function(){t.$success(t.$t("commons.modify_success")),t.dialogOrgMemberUpdateVisible=!1,t.cellClick(t.currentRow)})))}))}}},h=f,$=(o("232a"),o("cba8")),v=Object($["a"])(h,i,a,!1,null,"3f5657f6",null);t["default"]=v.exports}}]);