(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-42e47a1e"],{"30e7":function(e,t,o){},"4c50":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],staticClass:"table-card",scopedSlots:e._u([{key:"header",fn:function(){return[o("ms-table-header",{attrs:{"create-permission":["SYSTEM_TEST_POOL:READ+CREATE"],condition:e.condition,"create-tip":e.$t("test_resource_pool.create_resource_pool"),title:e.$t("commons.test_resource_pool")},on:{"update:condition":function(t){e.condition=t},search:e.search,create:e.create}})]},proxy:!0}])},[o("el-table",{staticClass:"adjust-table",staticStyle:{width:"100%"},attrs:{border:"",data:e.items,height:e.screenHeight}},[o("el-table-column",{attrs:{prop:"name",label:e.$t("commons.name")}}),o("el-table-column",{attrs:{prop:"description",label:e.$t("commons.description")}}),o("el-table-column",{attrs:{prop:"type",label:e.$t("test_resource_pool.type")},scopedSlots:e._u([{key:"default",fn:function(t){return["NODE"===t.row.type?o("span",[e._v("Node")]):e._e(),"K8S"===t.row.type?o("span",{directives:[{name:"xpack",rawName:"v-xpack"}]},[e._v("Kubernetes")]):e._e()]}}])}),o("el-table-column",{attrs:{prop:"status",label:e.$t("test_resource_pool.enable_disable")},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-switch",{attrs:{"inactive-color":"#DCDFE6","active-value":"VALID","inactive-value":"INVALID"},on:{change:function(o){return e.changeSwitch(t.row)}},model:{value:t.row.status,callback:function(o){e.$set(t.row,"status",o)},expression:"scope.row.status"}})]}}])}),o("el-table-column",{attrs:{prop:"createTime",label:e.$t("commons.create_time"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("timestampFormatDate")(t.row.createTime)))])]}}])}),o("el-table-column",{attrs:{prop:"updateTime",label:e.$t("commons.update_time"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("timestampFormatDate")(t.row.updateTime)))])]}}])}),o("el-table-column",{attrs:{label:e.$t("commons.operating")},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",[o("ms-table-operator",{attrs:{"edit-permission":["SYSTEM_TEST_POOL:READ+EDIT"],"delete-permission":["SYSTEM_TEST_POOL:READ+DELETE"]},on:{editClick:function(o){return e.edit(t.row)},deleteClick:function(o){return e.del(t.row)}}})],1)]}}])})],1),o("ms-table-pagination",{attrs:{change:e.initTableData,"current-page":e.currentPage,"page-size":e.pageSize,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t}}})],1),o("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.result.loading,expression:"result.loading"}],attrs:{"close-on-click-modal":!1,title:e.form.id?e.$t("test_resource_pool.update_resource_pool"):e.$t("test_resource_pool.create_resource_pool"),visible:e.dialogVisible,width:"80%",top:"5%","destroy-on-close":!0},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.closeFunc},scopedSlots:e._u([{key:"footer",fn:function(){return[e.form.id?o("ms-dialog-footer",{on:{cancel:function(t){e.dialogVisible=!1},confirm:function(t){return e.updateTestResourcePool()}}}):o("ms-dialog-footer",{on:{cancel:function(t){e.dialogVisible=!1},confirm:function(t){return e.createTestResourcePool()}}})]},proxy:!0}])},[o("div",{staticStyle:{height:"60vh",overflow:"auto"}},[o("el-form",{ref:"testResourcePoolForm",attrs:{model:e.form,"label-position":"right","label-width":"140px",size:"small",rules:e.rule}},[o("el-form-item",{attrs:{label:e.$t("commons.name"),prop:"name"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),o("el-form-item",{attrs:{label:e.$t("commons.description"),prop:"description"}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),o("el-form-item",{attrs:{label:e.$t("commons.image"),prop:"image"}},[o("el-input",{model:{value:e.form.image,callback:function(t){e.$set(e.form,"image",t)},expression:"form.image"}})],1),o("el-form-item",{attrs:{label:e.$t("test_resource_pool.usage"),prop:"image"}},[o("el-checkbox",{attrs:{label:e.$t("commons.api")},model:{value:e.form.api,callback:function(t){e.$set(e.form,"api",t)},expression:"form.api"}}),o("el-checkbox",{attrs:{label:e.$t("commons.performance")},model:{value:e.form.performance,callback:function(t){e.$set(e.form,"performance",t)},expression:"form.performance"}})],1),o("el-form-item",{attrs:{label:"JMeter HEAP",prop:"HEAP"}},[o("el-input",{attrs:{placeholder:"-Xms1g -Xmx1g -XX:MaxMetaspaceSize=256m"},model:{value:e.form.heap,callback:function(t){e.$set(e.form,"heap",t)},expression:"form.heap"}})],1),o("el-form-item",{attrs:{label:"JMeter GC_ALGO",prop:"GC_ALGO"}},[o("el-input",{attrs:{placeholder:"-XX:+UseG1GC -XX:MaxGCPauseMillis=100 -XX:G1ReservePercent=20"},model:{value:e.form.gcAlgo,callback:function(t){e.$set(e.form,"gcAlgo",t)},expression:"form.gcAlgo"}})],1),o("el-form-item",{attrs:{label:e.$t("test_resource_pool.type"),prop:"type"}},[o("el-select",{attrs:{placeholder:e.$t("test_resource_pool.select_pool_type")},on:{change:function(t){return e.changeResourceType(e.form.type)}},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[o("el-option",{key:"NODE",attrs:{value:"NODE",label:"Node"}},[e._v("Node")]),o("el-option",{directives:[{name:"xpack",rawName:"v-xpack"}],key:"K8S",attrs:{value:"K8S",label:"Kubernetes"}},[e._v("Kubernetes")])],1)],1),"K8S"===e.form.type?o("div",{directives:[{name:"xpack",rawName:"v-xpack"}],staticClass:"node-line"},e._l(e.infoList,(function(t,r){return o("div",{key:r},[o("el-row",[o("el-col",[o("el-form-item",{attrs:{label:"Master URL",rules:e.requiredRules}},[o("el-input",{attrs:{autocomplete:"new-password"},model:{value:t.masterUrl,callback:function(o){e.$set(t,"masterUrl",o)},expression:"item.masterUrl"}})],1)],1)],1),o("el-row",[o("el-col",[o("el-form-item",{attrs:{label:"Token",rules:e.requiredRules}},[o("el-input",{attrs:{type:"password","show-password":"",autocomplete:"new-password"},model:{value:t.token,callback:function(o){e.$set(t,"token",o)},expression:"item.token"}})],1)],1)],1),o("el-row",[o("el-col",[o("el-form-item",{attrs:{label:"Namespace",rules:e.requiredRules}},[o("el-input",{attrs:{type:"text"},model:{value:t.namespace,callback:function(o){e.$set(t,"namespace",o)},expression:"item.namespace"}})],1)],1)],1),o("el-row",[o("el-col",[o("el-form-item",{attrs:{label:"API Image"}},[o("el-input",{attrs:{type:"text"},model:{value:t.apiImage,callback:function(o){e.$set(t,"apiImage",o)},expression:"item.apiImage"}})],1)],1)],1),o("el-row",[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:e.$t("test_resource_pool.max_threads"),rules:e.requiredRules}},[o("el-input-number",{attrs:{min:1,max:1e9},model:{value:t.maxConcurrency,callback:function(o){e.$set(t,"maxConcurrency",o)},expression:"item.maxConcurrency"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:e.$t("test_resource_pool.pod_thread_limit"),rules:e.requiredRules}},[o("el-input-number",{attrs:{min:1,max:1e6},model:{value:t.podThreadLimit,callback:function(o){e.$set(t,"podThreadLimit",o)},expression:"item.podThreadLimit"}})],1)],1)],1),o("el-row",[o("el-col",[o("el-form-item",{attrs:{label:"nodeSelector"}},[o("el-input",{attrs:{placeholder:'{"disktype": "ssd",...}'},model:{value:t.nodeSelector,callback:function(o){e.$set(t,"nodeSelector",o)},expression:"item.nodeSelector"}})],1)],1)],1)],1)})),0):e._e(),"NODE"===e.form.type?o("div",{staticClass:"node-line"},[o("el-row",[o("el-col",{attrs:{span:22,offset:2}},[o("el-row",{staticStyle:{"margin-bottom":"10px"}},[o("el-col",{attrs:{span:8}},[o("el-button",{attrs:{icon:"el-icon-circle-plus-outline",plain:"",size:"mini"},on:{click:function(t){return e.addResourceInfo()}}},[e._v(" "+e._s(e.$t("commons.add"))+" ")])],1)],1),o("el-table",{staticClass:"tb-edit",attrs:{data:e.infoList,align:"center",border:"","highlight-current-row":""}},[o("el-table-column",{attrs:{align:"center",prop:"ip",label:"IP"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[o("el-input",{attrs:{size:"small",autocomplete:"off"},model:{value:r.ip,callback:function(t){e.$set(r,"ip",t)},expression:"row.ip"}})]}}],null,!1,1957804893)}),o("el-table-column",{attrs:{align:"center",prop:"port",label:"Port"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[o("el-input-number",{attrs:{size:"small",min:1,max:65535},model:{value:r.port,callback:function(t){e.$set(r,"port",t)},expression:"row.port"}})]}}],null,!1,4110649107)}),o("el-table-column",{attrs:{align:"center",prop:"monitorPort",label:"Monitor"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[o("el-input-number",{attrs:{size:"small",min:1,max:65535},model:{value:r.monitorPort,callback:function(t){e.$set(r,"monitorPort",t)},expression:"row.monitorPort"}})]}}],null,!1,3390430943)}),o("el-table-column",{attrs:{align:"center",prop:"maxConcurrency",label:e.$t("test_resource_pool.max_threads")},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[o("el-input-number",{attrs:{size:"small",min:1,max:1e9},model:{value:r.maxConcurrency,callback:function(t){e.$set(r,"maxConcurrency",t)},expression:"row.maxConcurrency"}})]}}],null,!1,1400892330)}),o("el-table-column",{attrs:{align:"center",label:e.$t("commons.operating")},scopedSlots:e._u([{key:"default",fn:function(t){t.row;var r=t.$index;return[o("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",circle:""},on:{click:function(t){return e.removeResourceInfo(r)}}})]}}],null,!1,1074580993)})],1)],1)],1)],1):e._e()],1)],1)])],1)},s=[],a=o("16ad"),n=(o("993f"),o("89a8"),o("1a91"),o("87d5"),o("978f")),i=o("59d9"),l=o("10b9"),c=o("1c98"),u=o("15bc"),m=o("495f"),p={name:"MsTestResourcePool",components:{MsCreateBox:n["a"],MsTablePagination:i["a"],MsTableHeader:l["a"],MsTableOperator:c["a"],MsDialogFooter:u["a"]},data:function(){return{result:{},dialogVisible:!1,infoList:[],queryPath:"testresourcepool/list",condition:{},items:[],currentPage:1,pageSize:10,total:0,form:{performance:!0,api:!0},screenHeight:"calc(100vh - 195px)",requiredRules:[{required:!0,message:this.$t("test_resource_pool.fill_the_data"),trigger:"blur"}],rule:{name:[{required:!0,message:this.$t("test_resource_pool.input_pool_name"),trigger:"blur"},{min:2,max:20,message:this.$t("commons.input_limit",[2,20]),trigger:"blur"},{required:!0,pattern:/^[\u4e00-\u9fa5_a-zA-Z0-9.Â·-]+$/,message:this.$t("test_resource_pool.pool_name_valid"),trigger:"blur"}],description:[{max:60,message:this.$t("commons.input_limit",[0,60]),trigger:"blur"}],type:[{required:!0,message:this.$t("test_resource_pool.select_pool_type"),trigger:"blur"}]},updatePool:{testName:"",haveTestUsePool:!1}}},activated:function(){this.initTableData()},methods:{initTableData:function(){var e=this;this.result=this.$post(this.buildPagePath(this.queryPath),this.condition,(function(t){var o=t.data;e.items=o.listObject,e.total=o.itemCount}))},changeResourceType:function(e){this.infoList=[];var t={};"NODE"===e&&(t.ip="",t.port="8082",t.monitorPort="9100"),"K8S"===e&&(t.masterUrl="",t.token="",t.namespace="",t.podThreadLimit=5e3),t.maxConcurrency=100,this.infoList.push(t)},addResourceInfo:function(){this.infoList.push({})},removeResourceInfo:function(e){this.infoList.length>1?this.infoList.splice(e,1):this.$warning(this.$t("test_resource_pool.cannot_remove_all_node"))},validateResourceInfo:function(){var e=this;if(this.infoList.length<=0)return{validate:!1,msg:this.$t("test_resource_pool.cannot_empty")};var t=this.form.type,o={validate:!0,msg:this.$t("test_resource_pool.fill_the_data")};return this.infoList.forEach((function(r){for(var s in r)if("nodeSelector"!==s&&"apiImage"!==s&&"0"!=r[s]&&!r[s])return o.validate=!1,!1;if(!r.maxConcurrency)return o.validate=!1,!1;if("K8S"===t&&r.nodeSelector){var a=e.isJsonString(r.nodeSelector);a||(o.validate=!1,o.msg=e.$t("test_resource_pool.node_selector_invalid"))}})),o},buildPagePath:function(e){return e+"/"+this.currentPage+"/"+this.pageSize},search:function(){this.initTableData()},create:function(){this.dialogVisible=!0,Object(m["v"])(this.closeFunc)},edit:function(e){this.dialogVisible=!0,this.form=JSON.parse(JSON.stringify(e)),this.convertResources(),Object(m["v"])(this.closeFunc)},convertResources:function(){var e=[];this.form.resources&&this.form.resources.forEach((function(t){var o=JSON.parse(t.configuration);o.id=t.id,o.monitorPort=o.monitorPort||"9100",e.push(o)})),this.infoList=e},del:function(e){var t=this;this.$confirm(this.$t("test_resource_pool.delete_prompt"),this.$t("commons.prompt"),{confirmButtonText:this.$t("commons.confirm"),cancelButtonText:this.$t("commons.cancel"),type:"warning"}).then((function(){t.result=t.$get("/testresourcepool/delete/".concat(e.id),(function(){t.initTableData(),t.$success(t.$t("commons.delete_success"))}))})).catch((function(){t.$info(t.$t("commons.delete_cancel"))}))},createTestResourcePool:function(){var e=this;this.$refs.testResourcePoolForm.validate((function(t){if(!t)return!1;var o=e.validateResourceInfo();if(!o.validate)return e.$warning(o.msg),!1;e.convertSubmitResources(),e.result=e.$post("/testresourcepool/add",e.form,(function(){e.$message({type:"success",message:e.$t("commons.save_success")},e.dialogVisible=!1,e.initTableData())}))}))},convertSubmitResources:function(){var e=[],t=this.form.id;this.infoList.forEach((function(o){var r=JSON.stringify(o),s={configuration:r,id:o.id};t&&(s.testResourcePoolId=t),e.push(s)})),this.form.resources=e},updateTestResourcePool:function(){var e=this;this.$refs.testResourcePoolForm.validate((function(t){if(!t)return!1;var o=e.validateResourceInfo();if(!o.validate)return e.$warning(o.msg),!1;e.convertSubmitResources(),e.result=e.$post("/testresourcepool/update",e.form,(function(){e.$message({type:"success",message:e.$t("commons.modify_success")},e.dialogVisible=!1,e.initTableData(),self.loading=!1)}))}))},closeFunc:function(){this.form={performance:!0,api:!0},this.dialogVisible=!1,Object(m["z"])(this.closeFunc)},changeSwitch:function(e){var t=this;if(this.result.loading=!0,this.$info(this.$t("test_resource_pool.check_in"),1e3),"VALID"===e.status)return this.updatePoolStatus(e),!1;"INVALID"===e.status&&this.checkHaveTestUsePool(e).then((function(){t.updatePool&&t.updatePool.haveTestUsePool?t.$confirm(t.$t("test_resource_pool.update_prompt",[t.updatePool.testName]),t.$t("commons.prompt"),{confirmButtonText:t.$t("commons.confirm"),cancelButtonText:t.$t("commons.cancel"),type:"warning"}).then((function(){t.updatePoolStatus(e)})).catch((function(){e.status="VALID",t.result.loading=!1,t.$info(t.$t("commons.cancel"))})):t.updatePoolStatus(e)}))},checkHaveTestUsePool:function(e){var t=this;return new Promise((function(o){t.$get("/testresourcepool/check/use/"+e.id,(function(e){t.updatePool=e.data,o()}))}))},updatePoolStatus:function(e){var t=this;this.$get("/testresourcepool/update/"+e.id+"/"+e.status).then((function(){t.$success(t.$t("test_resource_pool.status_change_success")),t.result.loading=!1})).catch((function(){t.$error(t.$t("test_resource_pool.status_change_failed")),e.status="INVALID",t.result.loading=!1}))},isJsonString:function(e){try{if("object"==Object(a["a"])(JSON.parse(e)))return!0}catch(t){console.log("json invalid")}return!1}}},f=p,d=(o("fe42"),o("cba8")),h=Object(d["a"])(f,r,s,!1,null,"323f98c2",null);t["default"]=h.exports},fe42:function(e,t,o){"use strict";o("30e7")}}]);