(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c0a92f8"],{"0a1e":function(e,t,i){"use strict";i("ecd78")},"3df1":function(e,t,i){},"4c9d":function(e,t,i){"use strict";i("5d27")},"5d27":function(e,t,i){},"661f":function(e,t,i){"use strict";i("682cd")},"682cd":function(e,t,i){},"9a53":function(e,t,i){"use strict";i("3df1")},e3df:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-card",[i("el-tabs",{staticClass:"system-setting",model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:e.$t("organization.message_settings"),name:"message"}},[i("message-notification")],1)],1)],1)],1)},s=[],a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-alert",{attrs:{title:"Notice:",type:"info","show-icon":""},scopedSlots:e._u([{key:"default",fn:function(){return[e._v(" "+e._s(e.$t("organization.message.notes"))+" ")]},proxy:!0}])}),i("jenkins-notification",{attrs:{"jenkins-receiver-options":e.jenkinsReceiverOptions}}),i("test-plan-task-notification",{attrs:{"test-plan-receiver-options":e.testPlanReceiverOptions}}),i("test-review-notification",{attrs:{"review-receiver-options":e.reviewReceiverOptions}}),i("defect-task-notification",{attrs:{"defect-receiver-options":e.defectReceiverOptions}})],1)},o=[],r=i("495f"),l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",[i("el-col",{attrs:{span:10}},[i("h3",[e._v(e._s(e.$t("organization.message.jenkins_task_notification")))]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{icon:"el-icon-circle-plus-outline",plain:"",size:"mini"},on:{click:e.handleAddTaskModel}},[e._v(" "+e._s(e.$t("organization.message.create_new_notification"))+" ")]),i("el-popover",{attrs:{placement:"right-end",title:"示例",width:"600",trigger:"click"}},[i("ms-code-edit",{attrs:{"read-only":!0,height:"400px",data:e.title,modes:e.modes,mode:"html"},on:{"update:data":function(t){e.title=t}}}),i("el-button",{attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.mail_template_example"))+" ")])],1),i("el-popover",{attrs:{placement:"right-end",title:"示例",width:"600",trigger:"click"}},[i("ms-code-edit",{attrs:{"read-only":!0,height:"200px",data:e.robotTitle,modes:e.modes,mode:"text"},on:{"update:data":function(t){e.robotTitle=t}}}),i("el-button",{attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.robot_template"))+" ")])],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-table",{staticClass:"tb-edit",attrs:{data:e.jenkinsTask,border:"","cell-style":e.rowClass,"header-cell-style":e.headClass}},[i("el-table-column",{attrs:{label:e.$t("schedule.event"),"min-width":"15%",prop:"events"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{placeholder:e.$t("organization.message.select_events"),size:"mini",prop:"events",disabled:!t.row.isSet},model:{value:t.row.event,callback:function(i){e.$set(t.row,"event",i)},expression:"scope.row.event"}},e._l(e.jenkinsEventOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("schedule.receiver"),prop:"userIds","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",size:"mini",placeholder:e.$t("commons.please_select"),disabled:!n.isSet},model:{value:n.userIds,callback:function(t){e.$set(n,"userIds",t)},expression:"row.userIds"}},e._l(e.jenkinsReceiverOptions,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("schedule.receiving_mode"),"min-width":"20%",prop:"type"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{placeholder:e.$t("organization.message.select_receiving_method"),size:"mini",disabled:!t.row.isSet},on:{change:function(i){return e.handleEdit(t.$index,t.row)}},model:{value:t.row.type,callback:function(i){e.$set(t.row,"type",i)},expression:"scope.row.type"}},e._l(e.receiveTypeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),i("el-table-column",{attrs:{label:"webhook","min-width":"20%",prop:"webhook"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-input",{attrs:{placeholder:"webhook地址",size:"mini",disabled:!t.row.isSet||!t.row.isReadOnly},model:{value:t.row.webhook,callback:function(i){e.$set(t.row,"webhook",i)},expression:"scope.row.webhook"}})]}}])}),i("el-table-column",{attrs:{label:e.$t("commons.operating"),"min-width":"25%",prop:"result"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSet?i("el-button",{directives:[{name:"xpack",rawName:"v-xpack"}],attrs:{type:"success",size:"mini"},on:{click:function(i){return e.handleTemplate(t.$index,t.row)}}},[e._v(e._s(e.$t("organization.message.template"))+" ")]):e._e(),t.row.isSet?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.handleAddTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.add"))+" ")]):e._e(),t.row.isSet?i("el-button",{attrs:{size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),e.removeRowTask(t.$index,e.jenkinsTask)}}},[e._v(e._s(e.$t("commons.cancel"))+" ")]):e._e(),t.row.isSet?e._e():i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.handleEditTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.edit"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"},{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),e.deleteRowTask(t.$index,t.row)}}})]}}])})],1)],1)],1),i("notice-template",{directives:[{name:"xpack",rawName:"v-xpack"}],ref:"noticeTemplate"})],1)},c=[],d=(i("89a8"),i("fe35"),i("993f"),i("2278")),u="JENKINS_TASK",p=i("cfb0"),m=p.keys().length>0?p("./notice/NoticeTemplate.vue"):{},v={name:"JenkinsNotification",components:{MsCodeEdit:d["a"],NoticeTemplate:m.default},props:{jenkinsReceiverOptions:{type:Array}},data:function(){return{modes:["text","html"],title:'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>MeterSphere</title>\n</head>\n<body>\n<div>\n    <div style="text-align: left">\n        <p>尊敬的用户：</p>\n        <p style="margin-left: 60px">您好:\n    </div>\n    <div style="margin-left: 100px">\n        <p>${testName} 接口测试运行失败/成功<br/>\n        <p>执行人:${executor}</p>        <p>执行环境:${executionEnvironment}</p>        <p>执行时间:${executionTime}</p>            请点击下面链接进入测试报告页面</p>\n        <a href="${url}/#/${type}/report/view/${id}">${url}/#/${type}/report/view/${id}</a>\n        <p>新版接口测试报告路径</p>\n        <a href="${url}/#/api/automation/report/view/">${url}/#/api/automation/report/view/${id}</a>\n    </div>\n\n</div>\n</body>\n</html>',robotTitle:"测试【任务通知】:'${executor}所执行的 ${testName} ${type}测试运行${status}\n测试环境为:${executionEnvironment}\n执行时间：${executionTime}\n请点击下面链接进入测试报告页面\n${url}/#/${type}/report/view/${id}新版接口测试报告路径\n${url}/#/api/automation/report/view/${id}",jenkinsTask:[{taskType:"jenkinsTask",event:"",userIds:[],type:[],webhook:"",isSet:!0,identification:"",isReadOnly:!1}],jenkinsEventOptions:[{value:"EXECUTE_SUCCESSFUL",label:this.$t("schedule.event_success")},{value:"EXECUTE_FAILED",label:this.$t("schedule.event_failed")}],receiveTypeOptions:[{value:"EMAIL",label:this.$t("organization.message.mail")},{value:"NAIL_ROBOT",label:this.$t("organization.message.nail_robot")},{value:"WECHAT_ROBOT",label:this.$t("organization.message.enterprise_wechat_robot")},{value:"LARK",label:this.$t("organization.message.lark")}]}},activated:function(){this.initForm()},methods:{initForm:function(){var e=this;this.result=this.$get("/notice/search/message/type/"+u,(function(t){e.jenkinsTask=t.data}))},handleEdit:function(e,t){t.isReadOnly=!0,"EMAIL"===t.type&&(t.isReadOnly=!t.isReadOnly,t.webhook="")},handleAddTaskModel:function(){var e={event:[],userIds:[],type:"",webhook:"",isSet:!0,identification:""};e.taskType=u,this.jenkinsTask.push(e)},handleAddTask:function(e,t){t.event&&t.userIds.length>0&&t.type?"NAIL_ROBOT"===t.type||"WECHAT_ROBOT"===t.type||"LARK"===t.type?t.webhook?this.addTask(t):this.$warning(this.$t("organization.message.message_webhook")):this.addTask(t):this.$warning(this.$t("organization.message.message"))},handleEditTask:function(e,t){t.isSet=!0,"EMAIL"===t.type?(t.isReadOnly=!1,t.webhook=""):t.isReadOnly=!0},addTask:function(e){var t=this;this.result=this.$post("/notice/save/message/task",e,(function(){t.initForm(),t.$success(t.$t("commons.save_success"))}))},removeRowTask:function(e,t){t[e].identification?t[parseInt(e)].isSet=!1:t.splice(e,1)},deleteRowTask:function(e,t){var i=this;this.result=this.$get("/notice/delete/message/"+t.identification,(function(e){i.$success(i.$t("commons.delete_success")),i.initForm()}))},rowClass:function(){return"text-align:center"},headClass:function(){return"text-align:center;background:'#ededed'"},handleTemplate:function(e,t){Object(r["p"])()&&this.$refs.noticeTemplate.open(t)}}},h=v,w=(i("9a53"),i("cba8")),f=Object(w["a"])(h,l,c,!1,null,"8f6d0786",null),k=f.exports,b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",[i("el-col",{attrs:{span:10}},[i("h3",[e._v(e._s(e.$t("organization.message.test_plan_task_notification")))]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{icon:"el-icon-circle-plus-outline",plain:"",size:"mini"},on:{click:e.handleAddTaskModel}},[e._v(" "+e._s(e.$t("organization.message.create_new_notification"))+" ")]),i("el-popover",{attrs:{placement:"right-end",title:"示例",width:"600",trigger:"click"}},[i("ms-code-edit",{attrs:{"read-only":!0,height:"400px",data:e.title,modes:e.modes,mode:"html"},on:{"update:data":function(t){e.title=t}}}),i("el-button",{attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.mail_template_example"))+" ")])],1),i("el-popover",{attrs:{placement:"right-end",title:"示例",width:"600",trigger:"click"}},[i("ms-code-edit",{attrs:{"read-only":!0,height:"200px",data:e.robotTitle,modes:e.modes,mode:"text"},on:{"update:data":function(t){e.robotTitle=t}}}),i("el-button",{attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.robot_template"))+" ")])],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-table",{staticClass:"tb-edit",attrs:{data:e.testCasePlanTask,border:"","cell-style":e.rowClass,"header-cell-style":e.headClass}},[i("el-table-column",{attrs:{label:e.$t("schedule.event"),"min-width":"15%",prop:"events"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{placeholder:e.$t("organization.message.select_events"),size:"mini",prop:"events",disabled:!t.row.isSet},on:{change:function(i){return e.handleTestPlanReceivers(t.row)}},model:{value:t.row.event,callback:function(i){e.$set(t.row,"event",i)},expression:"scope.row.event"}},e._l(e.otherEventOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("schedule.receiver"),prop:"userIds","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",size:"mini",placeholder:e.$t("commons.please_select"),disabled:!n.isSet},model:{value:n.userIds,callback:function(t){e.$set(n,"userIds",t)},expression:"row.userIds"}},e._l(n.testPlanReceiverOptions,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("schedule.receiving_mode"),"min-width":"20%",prop:"type"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{placeholder:e.$t("organization.message.select_receiving_method"),size:"mini",disabled:!t.row.isSet},on:{change:function(i){return e.handleEdit(t.$index,t.row)}},model:{value:t.row.type,callback:function(i){e.$set(t.row,"type",i)},expression:"scope.row.type"}},e._l(e.receiveTypeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),i("el-table-column",{attrs:{label:"webhook","min-width":"20%",prop:"webhook"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-input",{attrs:{placeholder:"webhook地址",size:"mini",disabled:!t.row.isSet||!t.row.isReadOnly},model:{value:t.row.webhook,callback:function(i){e.$set(t.row,"webhook",i)},expression:"scope.row.webhook"}})]}}])}),i("el-table-column",{attrs:{label:e.$t("commons.operating"),"min-width":"25%",prop:"result"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSet?i("el-button",{directives:[{name:"xpack",rawName:"v-xpack"}],attrs:{type:"success",size:"mini"},on:{click:function(i){return e.handleTemplate(t.$index,t.row)}}},[e._v(e._s(e.$t("organization.message.template"))+" ")]):e._e(),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.isSet,expression:"scope.row.isSet"}],attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.handleAddTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.add"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.isSet,expression:"scope.row.isSet"}],attrs:{size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),e.removeRowTask(t.$index,e.testCasePlanTask)}}},[e._v(e._s(e.$t("commons.cancel"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"},{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.handleEditTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.edit"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"},{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),e.deleteRowTask(t.$index,t.row)}}})]}}])})],1)],1)],1),i("notice-template",{directives:[{name:"xpack",rawName:"v-xpack"}],ref:"noticeTemplate"})],1)},T=[],_=(i("1a91"),i("87d5"),"TEST_PLAN_TASK"),g=i("cfb0"),$=g.keys().length>0?g("./notice/NoticeTemplate.vue"):{},y={name:"TestPlanTaskNotification",components:{MsCodeEdit:d["a"],NoticeTemplate:$.default},props:{testPlanReceiverOptions:{type:Array}},data:function(){return{modes:["text","html"],title:'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>MeterSphere</title>\n</head>\n<body>\n<div>\n    <p style="text-align: left">${creator} 创建的:<br>\n        ${testPlanName}<br>\n        计划开始时间是:${start}<br>\n        计划结束时间为:${end}<br>\n        请跟进！<br>\n        点击下面链接进入测试计划页面</p>\n    <a href="${url}/#/track/plan/all">${url}/#/track/plan/all</a>\n</div>\n</body>\n</html>',robotTitle:"   【任务通知】:${creator} 创建的:${testPlanName}计划开始时间是:${start}计划结束时间是：${end}请跟进！/ ${status}！点击下面链接进入测试计划页面${url}/#/track/plan/all",testCasePlanTask:[{taskType:"testPlanTask",event:"",userIds:[],type:[],webhook:"",isSet:!0,identification:"",isReadOnly:!1}],otherEventOptions:[{value:"CREATE",label:this.$t("commons.create")},{value:"UPDATE",label:this.$t("commons.update")},{value:"DELETE",label:this.$t("commons.delete")}],receiveTypeOptions:[{value:"EMAIL",label:this.$t("organization.message.mail")},{value:"NAIL_ROBOT",label:this.$t("organization.message.nail_robot")},{value:"WECHAT_ROBOT",label:this.$t("organization.message.enterprise_wechat_robot")},{value:"LARK",label:this.$t("organization.message.lark")}]}},methods:{initForm:function(){var e=this;this.result=this.$get("/notice/search/message/type/"+_,(function(t){e.testCasePlanTask=t.data,e.testCasePlanTask.forEach((function(t){e.handleTestPlanReceivers(t)}))}))},handleEdit:function(e,t){t.isReadOnly=!0,"EMAIL"===t.type&&(t.isReadOnly=!t.isReadOnly,t.webhook="")},handleEditTask:function(e,t){t.isSet=!0,"EMAIL"===t.type?(t.isReadOnly=!1,t.webhook=""):t.isReadOnly=!0},handleAddTaskModel:function(){var e={event:[],userIds:[],type:"",webhook:"",isSet:!0,identification:""};e.taskType=_,this.testCasePlanTask.push(e)},handleAddTask:function(e,t){t.event&&t.userIds.length>0&&t.type?"NAIL_ROBOT"===t.type||"WECHAT_ROBOT"===t.type||"LARK"===t.type?t.webhook?this.addTask(t):this.$warning(this.$t("organization.message.message_webhook")):this.addTask(t):this.$warning(this.$t("organization.message.message"))},addTask:function(e){var t=this;e.isSet=!1,this.result=this.$post("/notice/save/message/task",e,(function(){t.initForm(),t.$success(t.$t("commons.save_success"))}))},removeRowTask:function(e,t){t[e].identification?t[e].isSet=!1:t.splice(e,1)},deleteRowTask:function(e,t){var i=this;this.result=this.$get("/notice/delete/message/"+t.identification,(function(e){i.$success(i.$t("commons.delete_success")),i.initForm()}))},rowClass:function(){return"text-align:center"},headClass:function(){return"text-align:center;background:'#ededed'"},handleTestPlanReceivers:function(e){var t=JSON.parse(JSON.stringify(this.testPlanReceiverOptions));switch(e.event){case"CREATE":t.unshift({id:"EXECUTOR",name:this.$t("test_track.plan_view.executor")});break;case"UPDATE":case"DELETE":case"COMMENT":t.unshift({id:"FOUNDER",name:this.$t("api_test.creator")});break;default:break}e.testPlanReceiverOptions=t},handleTemplate:function(e,t){Object(r["p"])()&&this.$refs.noticeTemplate.open(t)}},watch:{testPlanReceiverOptions:function(e){e&&e.length>0&&this.initForm()}}},E=y,O=(i("661f"),Object(w["a"])(E,b,T,!1,null,"5336e91d",null)),A=O.exports,R=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",[i("el-col",{attrs:{span:10}},[i("h3",[e._v(e._s(e.$t("organization.message.test_review_task_notice")))]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{icon:"el-icon-circle-plus-outline",plain:"",size:"mini"},on:{click:e.handleAddTaskModel}},[e._v(" "+e._s(e.$t("organization.message.create_new_notification"))+" ")]),i("el-popover",{attrs:{placement:"right-end",title:"示例",width:"600",trigger:"click"}},[i("ms-code-edit",{attrs:{"read-only":!0,height:"400px",data:e.title,modes:e.modes,mode:"html"},on:{"update:data":function(t){e.title=t}}}),i("el-button",{attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.mail_template_example"))+" ")])],1),i("el-popover",{attrs:{placement:"right-end",title:"示例",width:"600",trigger:"click"}},[i("ms-code-edit",{attrs:{"read-only":!0,height:"200px",data:e.robotTitle,modes:e.modes,mode:"text"},on:{"update:data":function(t){e.robotTitle=t}}}),i("el-button",{attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.robot_template"))+" ")])],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-table",{staticClass:"tb-edit",attrs:{data:e.reviewTask,border:"","cell-style":e.rowClass,"header-cell-style":e.headClass}},[i("el-table-column",{attrs:{label:e.$t("schedule.event"),"min-width":"15%",prop:"events"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{placeholder:e.$t("organization.message.select_events"),size:"mini",prop:"event",disabled:!t.row.isSet},on:{change:function(i){return e.handleReviewReceivers(t.row)}},model:{value:t.row.event,callback:function(i){e.$set(t.row,"event",i)},expression:"scope.row.event"}},e._l(e.reviewTaskEventOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("schedule.receiver"),prop:"receiver","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",size:"mini",placeholder:e.$t("commons.please_select"),disabled:!n.isSet},model:{value:n.userIds,callback:function(t){e.$set(n,"userIds",t)},expression:"row.userIds"}},e._l(n.reviewReceiverOptions,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("schedule.receiving_mode"),"min-width":"20%",prop:"type"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{placeholder:e.$t("organization.message.select_receiving_method"),size:"mini",disabled:!t.row.isSet},on:{change:function(i){return e.handleEdit(t.$index,t.row)}},model:{value:t.row.type,callback:function(i){e.$set(t.row,"type",i)},expression:"scope.row.type"}},e._l(e.receiveTypeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),i("el-table-column",{attrs:{label:"webhook","min-width":"20%",prop:"webhook"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-input",{attrs:{placeholder:"webhook地址",size:"mini",disabled:!t.row.isSet||!t.row.isReadOnly},model:{value:t.row.webhook,callback:function(i){e.$set(t.row,"webhook",i)},expression:"scope.row.webhook"}})]}}])}),i("el-table-column",{attrs:{label:e.$t("commons.operating"),"min-width":"25%",prop:"result"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSet?i("el-button",{directives:[{name:"xpack",rawName:"v-xpack"}],attrs:{type:"success",size:"mini"},on:{click:function(i){return e.handleTemplate(t.$index,t.row)}}},[e._v(e._s(e.$t("organization.message.template"))+" ")]):e._e(),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.isSet,expression:"scope.row.isSet"}],attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.handleAddTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.add"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.isSet,expression:"scope.row.isSet"}],attrs:{size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),e.removeRowTask(t.$index,e.reviewTask)}}},[e._v(e._s(e.$t("commons.cancel"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"},{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.handleEditTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.edit"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"},{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),e.deleteRowTask(t.$index,t.row)}}})]}}])})],1)],1)],1),i("notice-template",{directives:[{name:"xpack",rawName:"v-xpack"}],ref:"noticeTemplate"})],1)},S=[],N="REVIEW_TASK",x=i("cfb0"),I=x.keys().length>0?x("./notice/NoticeTemplate.vue"):{},z={name:"TestReviewNotification",components:{MsCodeEdit:d["a"],NoticeTemplate:I.default},props:{reviewReceiverOptions:{type:Array}},data:function(){return{modes:["text","html"],title:'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>MeterSphere</title>\n</head>\n<body>\n<div>\n    <p style="text-align: left">${creator} 创建的:<br>\n        ${reviewName}待开始<br>\n        计划开始时间是:${start}<br>\n        计划结束时间为:${end}<br>\n        请跟进!/${status}<br>\n        点击下面链接进入评审页面进行审核</p>\n    <a href="${url}/#/track/review/view/${id}">${url}/#/track/review/view/${id}</a>\n</div>\n</body>\n</html>',robotTitle:"【任务通知】:${creator} 创建的:${reviewName}待开始,计划开始时间是:${start},计划结束时间是：${end}请跟进！/ ${status}！点击下面链接进入测试评审页面${url}/#/track/review/view/${id}",reviewTask:[{taskType:"reviewTask",event:"",userIds:[],type:[],webhook:"",isSet:!0,identification:"",isReadOnly:!1}],reviewTaskEventOptions:[{value:"CREATE",label:this.$t("commons.create")},{value:"UPDATE",label:this.$t("commons.update")},{value:"DELETE",label:this.$t("commons.delete")},{value:"COMMENT",label:this.$t("commons.comment")}],receiveTypeOptions:[{value:"EMAIL",label:this.$t("organization.message.mail")},{value:"NAIL_ROBOT",label:this.$t("organization.message.nail_robot")},{value:"WECHAT_ROBOT",label:this.$t("organization.message.enterprise_wechat_robot")},{value:"LARK",label:this.$t("organization.message.lark")}]}},methods:{initForm:function(){var e=this;this.result=this.$get("/notice/search/message/type/"+N,(function(t){e.reviewTask=t.data,e.reviewTask.forEach((function(t){e.handleReviewReceivers(t)}))}))},handleEdit:function(e,t){t.isReadOnly=!0,"EMAIL"===t.type&&(t.isReadOnly=!t.isReadOnly,t.webhook="")},handleEditTask:function(e,t){t.isSet=!0,"EMAIL"===t.type?(t.isReadOnly=!1,t.webhook=""):t.isReadOnly=!0},handleAddTaskModel:function(){var e={event:[],userIds:[],type:"",webhook:"",isSet:!0,identification:""};e.taskType=N,this.reviewTask.push(e)},handleAddTask:function(e,t){t.event&&t.userIds.length>0&&t.type?"NAIL_ROBOT"===t.type||"WECHAT_ROBOT"===t.type||"LARK"===t.type?t.webhook?this.addTask(t):this.$warning(this.$t("organization.message.message_webhook")):this.addTask(t):this.$warning(this.$t("organization.message.message"))},addTask:function(e){var t=this;e.isSet=!1,this.result=this.$post("/notice/save/message/task",e,(function(){t.initForm(),t.$success(t.$t("commons.save_success"))}))},removeRowTask:function(e,t){t[e].identification?t[e].isSet=!1:t.splice(e,1)},deleteRowTask:function(e,t){var i=this;this.result=this.$get("/notice/delete/message/"+t.identification,(function(e){i.$success(i.$t("commons.delete_success")),i.initForm()}))},rowClass:function(){return"text-align:center"},headClass:function(){return"text-align:center;background:'#ededed'"},handleReviewReceivers:function(e){var t=JSON.parse(JSON.stringify(this.reviewReceiverOptions));switch(e.event){case"CREATE":t.unshift({id:"EXECUTOR",name:this.$t("test_track.review.reviewer")});break;case"UPDATE":t.unshift({id:"FOUNDER",name:this.$t("test_track.review.review_creator")});break;case"DELETE":t.unshift({id:"FOUNDER",name:this.$t("test_track.review.review_creator")});break;case"COMMENT":t.unshift({id:"MAINTAINER",name:this.$t("test_track.case.maintainer")});break;default:break}e.reviewReceiverOptions=t},handleTemplate:function(e,t){Object(r["p"])()&&this.$refs.noticeTemplate.open(t)}},watch:{reviewReceiverOptions:function(e){e&&e.length>0&&this.initForm()}}},D=z,M=(i("0a1e"),Object(w["a"])(D,R,S,!1,null,"e1566bcc",null)),C=M.exports,G=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",[i("el-col",{attrs:{span:10}},[i("h3",[e._v(e._s(e.$t("organization.message.defect_task_notification")))]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{icon:"el-icon-circle-plus-outline",plain:"",size:"mini"},on:{click:e.handleAddTaskModel}},[e._v(" "+e._s(e.$t("organization.message.create_new_notification"))+" ")]),i("el-popover",{attrs:{placement:"right-end",title:"示例",width:"600",trigger:"click"}},[i("ms-code-edit",{attrs:{"read-only":!0,height:"400px",data:e.title,modes:e.modes,mode:"html"},on:{"update:data":function(t){e.title=t}}}),i("el-button",{attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.mail_template_example"))+" ")])],1),i("el-popover",{attrs:{placement:"right-end",title:"示例",width:"400",trigger:"click",content:e.robotTitle}},[i("ms-code-edit",{attrs:{"read-only":!0,height:"200px",data:e.robotTitle,modes:e.modes,mode:"text"},on:{"update:data":function(t){e.robotTitle=t}}}),i("el-button",{attrs:{slot:"reference",icon:"el-icon-warning",plain:"",size:"mini"},slot:"reference"},[e._v(" "+e._s(e.$t("organization.message.robot_template"))+" ")])],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-table",{staticClass:"tb-edit",attrs:{data:e.defectTask,border:"","cell-style":e.rowClass,"header-cell-style":e.headClass}},[i("el-table-column",{attrs:{label:e.$t("schedule.event"),"min-width":"15%",prop:"events"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{placeholder:e.$t("organization.message.select_events"),size:"mini",prop:"event",disabled:!t.row.isSet},model:{value:t.row.event,callback:function(i){e.$set(t.row,"event",i)},expression:"scope.row.event"}},e._l(e.defectEventOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("schedule.receiver"),prop:"receiver","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",size:"mini",placeholder:e.$t("commons.please_select"),disabled:!n.isSet},model:{value:n.userIds,callback:function(t){e.$set(n,"userIds",t)},expression:"row.userIds"}},e._l(e.defectReceiverOptions,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("schedule.receiving_mode"),"min-width":"20%",prop:"type"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{placeholder:e.$t("organization.message.select_receiving_method"),size:"mini",disabled:!t.row.isSet},on:{change:function(i){return e.handleEdit(t.$index,t.row)}},model:{value:t.row.type,callback:function(i){e.$set(t.row,"type",i)},expression:"scope.row.type"}},e._l(e.receiveTypeOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),i("el-table-column",{attrs:{label:"webhook","min-width":"20%",prop:"webhook"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-input",{attrs:{placeholder:"webhook地址",size:"mini",disabled:!t.row.isSet||!t.row.isReadOnly},model:{value:t.row.webhook,callback:function(i){e.$set(t.row,"webhook",i)},expression:"scope.row.webhook"}})]}}])}),i("el-table-column",{attrs:{label:e.$t("commons.operating"),"min-width":"25%",prop:"result"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSet?i("el-button",{directives:[{name:"xpack",rawName:"v-xpack"}],attrs:{type:"success",size:"mini"},on:{click:function(i){return e.handleTemplate(t.$index,t.row)}}},[e._v(e._s(e.$t("organization.message.template"))+" ")]):e._e(),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.isSet,expression:"scope.row.isSet"}],attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.handleAddTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.add"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.row.isSet,expression:"scope.row.isSet"}],attrs:{size:"mini"},nativeOn:{click:function(i){return i.preventDefault(),e.removeRowTask(t.$index,e.defectTask)}}},[e._v(e._s(e.$t("commons.cancel"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"},{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.handleEditTask(t.$index,t.row)}}},[e._v(e._s(e.$t("commons.edit"))+" ")]),i("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.row.isSet,expression:"!scope.row.isSet"},{name:"permission",rawName:"v-permission",value:["ORGANIZATION_MESSAGE:READ+EDIT"],expression:"['ORGANIZATION_MESSAGE:READ+EDIT']"}],attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(i){return e.deleteRowTask(t.$index,t.row)}}})]}}])})],1)],1)],1),i("notice-template",{directives:[{name:"xpack",rawName:"v-xpack"}],ref:"noticeTemplate"})],1)},L=[],P="DEFECT_TASK",j=i("cfb0"),F=j.keys().length>0?j("./notice/NoticeTemplate.vue"):{},Z={name:"DefectTaskNotification",components:{MsCodeEdit:d["a"],NoticeTemplate:F.default},props:{defectReceiverOptions:{type:Array}},data:function(){return{modes:["text","html"],title:'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>MeterSphere</title>\n</head>\n<body>\n<div>\n    <p>${creator}发起了一个缺陷:${issuesName}，请跟进</p>\n</div>\n</body>\n</html>',robotTitle:"【任务通知】:${creator}发起了一个缺陷:${issuesName}，请跟进",defectTask:[{taskType:"defectTask",event:"",userIds:[],type:[],webhook:"",isSet:!0,identification:"",isReadOnly:!1}],defectEventOptions:[{value:"CREATE",label:this.$t("commons.create")}],receiveTypeOptions:[{value:"EMAIL",label:this.$t("organization.message.mail")},{value:"NAIL_ROBOT",label:this.$t("organization.message.nail_robot")},{value:"WECHAT_ROBOT",label:this.$t("organization.message.enterprise_wechat_robot")},{value:"LARK",label:this.$t("organization.message.lark")}]}},activated:function(){this.initForm()},methods:{initForm:function(){var e=this;this.result=this.$get("/notice/search/message/type/"+P,(function(t){e.defectTask=t.data}))},handleEdit:function(e,t){t.isReadOnly=!0,"EMAIL"===t.type&&(t.isReadOnly=!t.isReadOnly,t.webhook="")},handleEditTask:function(e,t){t.isSet=!0,"EMAIL"===t.type?(t.isReadOnly=!1,t.webhook=""):t.isReadOnly=!0},handleAddTaskModel:function(){var e={event:[],userIds:[],type:"",webhook:"",isSet:!0,identification:""};e.taskType=P,this.defectTask.push(e)},handleAddTask:function(e,t){t.event&&t.userIds.length>0&&t.type?"NAIL_ROBOT"===t.type||"WECHAT_ROBOT"===t.type||"LARK"===t.type?t.webhook?this.addTask(t):this.$warning(this.$t("organization.message.message_webhook")):this.addTask(t):this.$warning(this.$t("organization.message.message"))},addTask:function(e){var t=this;e.isSet=!1,this.result=this.$post("/notice/save/message/task",e,(function(){t.initForm(),t.$success(t.$t("commons.save_success"))}))},removeRowTask:function(e,t){t[e].identification?t[e].isSet=!1:t.splice(e,1)},deleteRowTask:function(e,t){var i=this;this.result=this.$get("/notice/delete/message/"+t.identification,(function(e){i.$success(i.$t("commons.delete_success")),i.initForm()}))},rowClass:function(){return"text-align:center"},headClass:function(){return"text-align:center;background:'#ededed'"},handleTemplate:function(e,t){Object(r["p"])()&&this.$refs.noticeTemplate.open(t)}}},U=Z,B=(i("4c9d"),Object(w["a"])(U,G,L,!1,null,"157fcf3a",null)),K=B.exports,J=i("1b11"),W=i("489a"),H={name:"TaskNotification",components:{DefectTaskNotification:K,TestReviewNotification:C,TestPlanTaskNotification:A,JenkinsNotification:k,MsContainer:J["a"],MsMainContainer:W["a"]},data:function(){return{jenkinsReceiverOptions:[],testPlanReceiverOptions:[],reviewReceiverOptions:[],defectReceiverOptions:[]}},activated:function(){this.initUserList()},methods:{handleEdit:function(e,t){t.isReadOnly=!0,"EMAIL"===t.type&&(t.isReadOnly=!t.isReadOnly)},currentUser:function(){return Object(r["h"])()},initUserList:function(){var e=this,t={name:"",organizationId:Object(r["f"])()};this.result=this.$post("user/org/member/list/all",t,(function(t){e.jenkinsReceiverOptions=t.data,e.reviewReceiverOptions=t.data,e.defectReceiverOptions=t.data,e.testPlanReceiverOptions=t.data}))}}},X=H,Y=Object(w["a"])(X,a,o,!1,null,"6d002036",null),V=Y.exports,q={name:"MessageSettings",components:{MessageNotification:V},data:function(){return{activeName:"message"}}},Q=q,ee=Object(w["a"])(Q,n,s,!1,null,"d5fbc806",null);t["default"]=ee.exports},ecd78:function(e,t,i){}}]);